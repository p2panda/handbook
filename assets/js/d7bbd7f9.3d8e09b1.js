(self.webpackChunkhandbook=self.webpackChunkhandbook||[]).push([[9717],{6311:(e,i,n)=>{e.exports={src:{srcSet:n.p+"assets/ideal-img/collaboration.827c036.940.png 940w",images:[{path:n.p+"assets/ideal-img/collaboration.827c036.940.png",width:940,height:658}],src:n.p+"assets/ideal-img/collaboration.827c036.940.png",toString:function(){return n.p+"assets/ideal-img/collaboration.827c036.940.png"},placeholder:void 0,width:940,height:658},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAHCAYAAAAxrNxjAAAACXBIWXMAAAsTAAALEwEAmpwYAAABB0lEQVR4nGOw948XqG6eIl9fX8/EwMDAUF5ezj9nzhxeELu+3p5l4sRWURCbQb/9ylnLjnPPpNuf7jnf4l/+uMXu4f1Ghweve03L3x1U3nN3vfKDD/tUjzLotl9vMm87O1u2/WHD6UZf//vNDrNvNTjPftFjFvBqn1LbjTUqC9/sVulh0Ou4Otu648xW2fbHU881ecc9bLLbfq/ZcdfLJvMgkI3/V4UyQ6xuu7zapuPUYaWOB0uPNvjHPmhxXH+r2WXL00Yrf5D8lVVabP//M4Ddz/C/HsJ43mhufq/Jof5ek109iI0sx8Dw/z/jmZlprCDm00bLipfdrv9fdrn+B7EhCu1ZQOoAPfh2LJ8ZAEUAAAAASUVORK5CYII="}},5713:(e,i,n)=>{e.exports={src:{srcSet:n.p+"assets/ideal-img/collections.8f856dd.1640.png 1640w",images:[{path:n.p+"assets/ideal-img/collections.8f856dd.1640.png",width:1640,height:704}],src:n.p+"assets/ideal-img/collections.8f856dd.1640.png",toString:function(){return n.p+"assets/ideal-img/collections.8f856dd.1640.png"},placeholder:void 0,width:1640,height:704},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAECAYAAAC3OK7NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAjUlEQVR4nCXJ0QqCMBiG4d3/5YThmgkeDIwSt7WuoUBzY2soKPu/yA6ek/dlGagz8ACgicjMy7LLRAbAHf93ZgAEgF/st23bgUgB6JDzaZ4Xva6rYC4k4UMyk4/ta5z6YfJXF9PNhU/nYzo8h7ceXRSslKoupbJVawsutala23CpmqLpTHUxRy6V5dLUXzOljYDh2nieAAAAAElFTkSuQmCC"}},4517:(e,i,n)=>{e.exports={src:{srcSet:n.p+"assets/ideal-img/document.66bea05.848.png 848w",images:[{path:n.p+"assets/ideal-img/document.66bea05.848.png",width:848,height:676}],src:n.p+"assets/ideal-img/document.66bea05.848.png",toString:function(){return n.p+"assets/ideal-img/document.66bea05.848.png"},placeholder:void 0,width:848,height:676},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAICAYAAADA+m62AAAACXBIWXMAAAsTAAALEwEAmpwYAAABCUlEQVR4nB2PzUrDQBhF82I+QYv6CD6cS8Gle3EhNIlYsAFLUNtJ06TNZP4nP/PNlXZxVvdw4SSv7+n9W/r5wI7HW2nMouVyWbd8WXO+5HJYnLi9q1p+kwjjiwjADBMJ42CHEX4O8BNBGU0URwg75BdxE+OMQ1XSoRXQ1kP2FdabLZrditA9o9MhT3pti5kCetFRrxy081BGoK4b/LYtlUZCKncRXRFoBGPfVDUCyhjw7g/ltkTO9vTS7mG1vz5u/DRDaBmk9dH6MSotI6tYLHbnkO4naGuzZA5UAAABFABcwrxrUNcMP2dHH6frmied0E9C2bVQNhXKZvyKyrSfMuf9avL2q5Pm8R8OOSSeQ83TAgAAAABJRU5ErkJggg=="}},7372:(e,i,n)=>{e.exports={src:{srcSet:n.p+"assets/ideal-img/extensions.20522a4.1478.png 1478w",images:[{path:n.p+"assets/ideal-img/extensions.20522a4.1478.png",width:1478,height:868}],src:n.p+"assets/ideal-img/extensions.20522a4.1478.png",toString:function(){return n.p+"assets/ideal-img/extensions.20522a4.1478.png"},placeholder:void 0,width:1478,height:868},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAGCAYAAAD68A/GAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAx0lEQVR4nBXKy06DQABAUf7/h9SViQssD5uGKo8ORBgotDBMByqvdHFNF2d3LLM8GOeFvvFRlYOqPRp9pb4ZmjBBOj5tKLB0I1FlirnE6L4hlxI7FOwOCcV3hRIdujNYbfhJ4b8zVILz9YHvar72imI/kH7UVIHG3Dcs0yuGXnE857yGMU5+ofydcN8y3JeMtpq4r884bQzzxknf8EpJEP8go5QsaBHHDtuL8MMUy/wtPA3TyjivlCIjT06M04KZV+xDxC5I+AcT+drDsMTJJAAAAABJRU5ErkJggg=="}},5285:(e,i,n)=>{e.exports={src:{srcSet:n.p+"assets/ideal-img/fork.f2654cb.1710.png 1710w",images:[{path:n.p+"assets/ideal-img/fork.f2654cb.1710.png",width:1710,height:677}],src:n.p+"assets/ideal-img/fork.f2654cb.1710.png",toString:function(){return n.p+"assets/ideal-img/fork.f2654cb.1710.png"},placeholder:void 0,width:1710,height:677},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAECAYAAAC3OK7NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAjklEQVR4nGNgYGBgsK/fzwKiNdpuxht2XP1p2n7xq1b7zaMMq/4zg8QR4P9/RhBl3HxZ2abjVKJT17F0w7YLHvX19Uwo6jRar+kYdFxdY9F+Zq1B57UW7e47EWadF5ebdVzcpN1+vRSuULP5qp1xx+W3Fu3nvui3Xz2j1Xajy6zz4k+z9vNfdNquLQUpAgC4dDo6ceVJeAAAAABJRU5ErkJggg=="}},5021:(e,i,n)=>{e.exports={src:{srcSet:n.p+"assets/ideal-img/hashing.9b6b69d.1280.png 1280w",images:[{path:n.p+"assets/ideal-img/hashing.9b6b69d.1280.png",width:1280,height:200}],src:n.p+"assets/ideal-img/hashing.9b6b69d.1280.png",toString:function(){return n.p+"assets/ideal-img/hashing.9b6b69d.1280.png"},placeholder:void 0,width:1280,height:200},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAACCAYAAABhYU3QAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAQklEQVR4nGNgYGBg+P//P/e379/P/Pj58/SqVavkPn78XPD9x8/Pf/78SYPKs4BosMKv376f+f79B1zht+8/UBQCAEoGNAA9o/kZAAAAAElFTkSuQmCC"}},343:(e,i,n)=>{e.exports={src:{srcSet:n.p+"assets/ideal-img/key-reuse.4cc0cd6.1310.png 1310w",images:[{path:n.p+"assets/ideal-img/key-reuse.4cc0cd6.1310.png",width:1310,height:328}],src:n.p+"assets/ideal-img/key-reuse.4cc0cd6.1310.png",toString:function(){return n.p+"assets/ideal-img/key-reuse.4cc0cd6.1310.png"},placeholder:void 0,width:1310,height:328},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAADCAYAAACqPZ51AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAcElEQVR4nGP4//8/EwMDA8OvX18Lr107YfH9+xf3O/fvJNjl9/tt27aNnYGBgREkz/D//38w4/Lls5otLQWSn9+/drx882yQe9Us/56eHrX9+/ezgBXCwKpVq5hB9NsX9y1v3jzm0rn6kPP++nq4IgBpDTE3qd7q1AAAAABJRU5ErkJggg=="}},240:(e,i,n)=>{e.exports={src:{srcSet:n.p+"assets/ideal-img/linked-list.182b507.1150.png 1150w",images:[{path:n.p+"assets/ideal-img/linked-list.182b507.1150.png",width:1150,height:154}],src:n.p+"assets/ideal-img/linked-list.182b507.1150.png",toString:function(){return n.p+"assets/ideal-img/linked-list.182b507.1150.png"},placeholder:void 0,width:1150,height:154},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAABCAYAAADn9T9+AAAACXBIWXMAAAsTAAALEwEAmpwYAAAANElEQVR4nAEpANb/APf17Ix5hW4X9fX1TeXg1GUAAGYF8fHmh3N/cxbz8/BZ4d7MVjw8SBX/NxcsTgE21AAAAABJRU5ErkJggg=="}},3571:(e,i,n)=>{e.exports={src:{srcSet:n.p+"assets/ideal-img/log-depth.5acc26d.1214.png 1214w",images:[{path:n.p+"assets/ideal-img/log-depth.5acc26d.1214.png",width:1214,height:458}],src:n.p+"assets/ideal-img/log-depth.5acc26d.1214.png",toString:function(){return n.p+"assets/ideal-img/log-depth.5acc26d.1214.png"},placeholder:void 0,width:1214,height:458},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAECAYAAAC3OK7NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAjUlEQVR4nGP48uXNMm9vG8Gvnz8WPrp/JfLWrZfKr18+aunvny/w/ev79k2bZoowMDCwMjx/cEJxZn091/PnF8RWzS4U+vD9v/LTpzcbuqZMkfjy8UnJ0qUghTKcDDDw//9/Rigt8uzRWY8zZ85wff38um3VqrmiYBNxgf///7N9ev8gedXseiEGBgY2ANYeRrL5cv6fAAAAAElFTkSuQmCC"}},6132:(e,i,n)=>{e.exports={src:{srcSet:n.p+"assets/ideal-img/operation-example.127ea02.1280.png 1280w",images:[{path:n.p+"assets/ideal-img/operation-example.127ea02.1280.png",width:1280,height:1098}],src:n.p+"assets/ideal-img/operation-example.127ea02.1280.png",toString:function(){return n.p+"assets/ideal-img/operation-example.127ea02.1280.png"},placeholder:void 0,width:1280,height:1098},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAJCAYAAAALpr0TAAAACXBIWXMAAAsTAAALEwEAmpwYAAABBElEQVR4nGXPzUrDQBSG4WmXViyCboTiBfQicyHuBLsQQSL+IFJFChZi60IUNQuL2naSZiahmcnJnEnCEXe1+dYPH7yMMcaIqEkEHSLq9Fy3e9UfdIloP4uiPbY6ItrIMrie8nBsrT0yBu9lkn4YUxwSUWMVtpZKe/NQTBTAJQC+yiSVgPasBlOd3U7ni2dEewzGDEMRfxprezWoNXjBQkzQ2oulhpcfHgmdo1uDiMWAh/K9rKpTBflYJukMcjxZh404jttE1L4bjXaefH+XiLZ9Ibb+VXPOWwbtTZ6b4YwH3iISDwbxsajoYP1xE23xluosUFp/K6W/AIwsy/LccZzmH/oFTgHomJ2RtPcAAAAASUVORK5CYII="}},4709:(e,i,n)=>{e.exports={src:{srcSet:n.p+"assets/ideal-img/ordering.84e6ba0.1950.png 1950w",images:[{path:n.p+"assets/ideal-img/ordering.84e6ba0.1950.png",width:1950,height:1955}],src:n.p+"assets/ideal-img/ordering.84e6ba0.1950.png",toString:function(){return n.p+"assets/ideal-img/ordering.84e6ba0.1950.png"},placeholder:void 0,width:1950,height:1955},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAACXBIWXMAAAsTAAALEwEAmpwYAAABUklEQVR4nGNgYGBg0Kw/7WXcfmGqdtvl9tiFd12+f37b8PP334n///9PYkAGum03ssw7Lr7Ubzl/I3np/cz///+e+PHr99v////PhyphBJNSrc8yNTvvPlFou3fFb+GrpP//f8z79uPnvv///9ejmLiuPi1jdVPOg1X16Zf2z2pJ+Pz7/9Q3H75u+fHjVwWKwg+t+tmvO6yev2o1vvFlbmTil///+798+b7ux49fJSgKf5xSyb+/Q/nz411yj75eDsl6/Obv5pfv3l/7+fN3P4rC94sNUh7MNr71eJbu6fdbYhIevfmx8vX7Tye///zZjqLwaY11/v0G10/3q+0ePp+Rkf3y6999Hz5+evT379/pqAobLQrutTh+ud9o9fj5rJTsp5/+bHv59v3Nb99+TEJV2GzldrfdbebdOqvuN2sbAx+++vjg8Ys3/z9/+bIWFo4A3J7GJJfnrPIAAAAASUVORK5CYII="}},1032:(e,i,n)=>{e.exports={src:{srcSet:n.p+"assets/ideal-img/previous-ordering.e5609bd.1710.png 1710w",images:[{path:n.p+"assets/ideal-img/previous-ordering.e5609bd.1710.png",width:1710,height:2283}],src:n.p+"assets/ideal-img/previous-ordering.e5609bd.1710.png",toString:function(){return n.p+"assets/ideal-img/previous-ordering.e5609bd.1710.png"},placeholder:void 0,width:1710,height:2283},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAANCAYAAACQN/8FAAAACXBIWXMAAAsTAAALEwEAmpwYAAABdUlEQVR4nGPQab9x2aLjwmu99ssfNdtv+DMwMDCErvrPDKJRgFr9DQ3bjtNmJu0XDJU67vJDRP8zYijU7bi+wqLz/F79tssHdTpv2YMFQ1dhmqjbdmW/dceZG4Ztl26pdNx1xakQBP4zMDAe6w3l/D9Rhf1+vT3HlXotNrAEMpg5M40VRD9ptMq43+r0+l6L06NnzVbLMRT+r7dnAdFPG8zz77c4/7vT4vLjUZPNLob6/0xQJage+1/PwLQpzZhrfn28wH57Bpb6+ol8/8+ksf7/z8AIkmP4vyoU7PAXTRZRD1ucLtxpdT7/pMa68/thDddnO1Qv3l2vcvbzAZUNcKufN1mUvulx//+02+P/oxqbTf9Pq4e82qX+/856tf8f9qrch1u9v16e40Kxpdj+eg+Z66XqvIsWZYjd3W0t93KLqMSnQyqicKufN1qGPmxxPHK3xfnAkyabfob6ephnUH39vt2q9PMEj/8vezz/v22zPYDuYwCJVqLAaJzhqgAAAABJRU5ErkJggg=="}},6185:(e,i,n)=>{e.exports={src:{srcSet:n.p+"assets/ideal-img/yjs-example.6c62c90.1930.png 1930w",images:[{path:n.p+"assets/ideal-img/yjs-example.6c62c90.1930.png",width:1930,height:1788}],src:n.p+"assets/ideal-img/yjs-example.6c62c90.1930.png",toString:function(){return n.p+"assets/ideal-img/yjs-example.6c62c90.1930.png"},placeholder:void 0,width:1930,height:1788},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAJCAYAAAALpr0TAAAACXBIWXMAAAsTAAALEwEAmpwYAAABW0lEQVR4nGPYdOjyyr3n7r49dufdmfu3b3c9uXD4/ctrp/5/f3ipg4GBgeH////MIJohJjHffN2By5o3/v8XaWvq8Tuzd0vpyysnc389vmAOVcjIAANTpqziAdEf7531e3rp6LvHFw7//Pn4YhNI7MyZNNb//xmYwArr66eAFVZWdrgeP3Ag7+ndayn/3z81QjFRpfFagXHL2Z1yjXcW9pYXxrwolp9yvUh78Ytyyah3B6T6bq+W2fp+t/R0hoBZd2dEzLzy3WPmgxsrZk5sejU9+un9qYm/3s2N6n17zHX/3e1u398dcz8DMnrC718/3/7/8+vC////a379+X/5x++/z/7+/9/y68//HT9//X/z5///Qwz//v3je/bsmfzZq1flL1++LXvz5l3bG3fuON++fVvl4sWLMs+fP1f4//+/CNidsLD6//+/28dPn558/PT547dv36qRwxEAsZLUU1zKM4MAAAAASUVORK5CYII="}},2366:(e,i,n)=>{"use strict";n.r(i),n.d(i,{assets:()=>d,contentTitle:()=>r,default:()=>p,frontMatter:()=>a,metadata:()=>l,toc:()=>c});var t=n(5893),s=n(1151),o=n(2233);const a={title:"namakemono"},r=void 0,l={id:"specifications/namakemono/index",title:"namakemono",description:"\ud83e\udda5 namakemono = Sloth (Japanese) = Slow and forgetful = very delay-tolerant, offline-first and privacy-respecting \ud83e\ude77",source:"@site/docs/specifications/namakemono/index.md",sourceDirName:"specifications/namakemono",slug:"/specifications/namakemono/",permalink:"/specifications/namakemono/",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{title:"namakemono"},sidebar:"specifications",previous:{title:"Specifications",permalink:"/specifications/"},next:{title:"aquadoggo API",permalink:"/specifications/aquadoggo/"}},d={},c=[{value:"Short overview",id:"short-overview",level:2},{value:"Encoding &amp; Cryptographic Primitives",id:"encoding--cryptographic-primitives",level:2},{value:"Documents",id:"documents",level:2},{value:"Operations",id:"operations",level:2},{value:"Creating documents",id:"creating-documents",level:2},{value:"Updating documents",id:"updating-documents",level:2},{value:"Collaboration",id:"collaboration",level:2},{value:"Ordering",id:"ordering",level:2},{value:"Views",id:"views",level:2},{value:"Forks",id:"forks",level:2},{value:"History",id:"history",level:2},{value:"Deletion",id:"deletion",level:2},{value:"Garbage Collection",id:"garbage-collection",level:3},{value:"Operations",id:"operations-1",level:4},{value:"Documents",id:"documents-1",level:4},{value:"Tombstones",id:"tombstones",level:3},{value:"Extensions",id:"extensions",level:2},{value:"Ephemeral documents",id:"ephemeral-documents",level:3},{value:"Schemas",id:"schemas",level:3},{value:"Collections",id:"collections",level:3},{value:"Capabilities",id:"capabilities",level:3},{value:"Encryption",id:"encryption",level:3},{value:"Replication",id:"replication",level:2}];function h(e){const i={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(i.blockquote,{children:["\n",(0,t.jsx)(i.p,{children:"\ud83e\udda5 namakemono = Sloth (Japanese) = Slow and forgetful = very delay-tolerant, offline-first and privacy-respecting \ud83e\ude77"}),"\n"]}),"\n",(0,t.jsxs)(i.p,{children:[(0,t.jsx)(i.strong,{children:"namakemono"})," is a protocol for peer-to-peer and federated applications. It gives them sloth-superpowers: offline-first collaboration, fine-grained permissions, data validation, schema migration, decentralised group encryption, low memory footprint, efficient replication and privacy-respecting deletion."]}),"\n",(0,t.jsx)(o.Z,{title:"Sloth-Superpowers!",url:n(7372)}),"\n",(0,t.jsxs)(i.p,{children:[(0,t.jsx)(i.strong,{children:"namakemono"})," was designed to solve common privacy- and efficiency problems when building collaborative applications in peer-to-peer systems. This includes:"]}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Offline-first collaboration:"}),' Create and edit data with others, even when you\'re offline. Distributed systems usually compromise on "how long" you can be offline, namakemono gives you the tools to stay offline as long as you want']}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Fine-grained capabilities:"})," Full control over your data by defining who can sync, create, update or delete what. Usually capability system require nodes to be online, namakemono allows capabilities to be offline-first"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"End-to-end encryption:"})," Secure group encryption with PCS and FS"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Don't grow data forever, except if you want to:"})," Keep the history of all changes if you need them, or delete old data instantly when your application does not require it, even of other authors"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Hybrid networks:"})," Use namakemono in both peer-to-peer or federated networks, or even both of them at the same time"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Privacy-respecting deletion:"})," Delete whole collections of data with one tombstone or let data disappear by itself, giving it an expiry date"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Schemas:"})," Define and distribute versioned and migratable schemas of your choice to validate incoming data"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Collections:"})," Structure hierarchies of data collections, combining them with permissions to model user-roles, moderation, admin access and more typical application concerns"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Re-use your key-pair:"})," .. on multiple devices without being afraid of accidental forks"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Efficient and partial sync:"})," namakemono is still a linked-list and can leverage from fast, simple and efficient log-replication"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Flexible:"})," Use any CRDT, database, transport, data validation format, encoding, digital signature algorithm or hashing algorithm you want!"]}),"\n"]}),"\n",(0,t.jsxs)(i.admonition,{title:"Status: Draft",type:"note",children:[(0,t.jsx)(i.p,{children:"namakemono is based on the original p2panda specification and can be seen as the next, simplified iteration. It helps us to leverage from the best parts we've came up with so far over the last years, separate application concerns more from the protocol (\"bring your own CRDT\") and remove the Bamboo append-only log data type (as we realized we haven't used it in the form it was designed for)."}),(0,t.jsxs)(i.p,{children:["If you have any comments or feedback on this specification. Please ",(0,t.jsx)(i.a,{href:"/contact",children:"contact us"}),"!"]})]}),"\n",(0,t.jsx)(i.h2,{id:"short-overview",children:"Short overview"}),"\n",(0,t.jsx)(o.Z,{title:"namakemono is a little bit like a typical append-only log, secured by signatures and cryptographic backlinks, but with a few tricks!",url:n(240)}),"\n",(0,t.jsx)(o.Z,{title:"Old data in the log + metadata can be removed directly as soon as new data arrives! How much history you want to keep is configurable",url:n(3571)}),"\n",(0,t.jsx)(o.Z,{title:"Key pair reuse across multiple devices and accidental forks are tolerated",url:n(343)}),"\n",(0,t.jsx)(o.Z,{title:"Multiple authors can collaborate on the same document - in this example with maximum depth(2)",url:n(4517)}),"\n",(0,t.jsx)(i.h2,{id:"encoding--cryptographic-primitives",children:"Encoding & Cryptographic Primitives"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"Namakemono works theoretically with any data encoding, digital signature algorithm (DSA) or hashing algorithm"}),"\n",(0,t.jsxs)(i.li,{children:["We recommend ",(0,t.jsx)(i.strong,{children:"Ed25519"})," for signatures, ",(0,t.jsx)(i.strong,{children:"BLAKE3"})," for hashing and ",(0,t.jsx)(i.strong,{children:"CBOR"})," for encoding"]}),"\n"]}),"\n",(0,t.jsx)(i.h2,{id:"documents",children:"Documents"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Documents"})," is how we distinguish one piece of data from another"]}),"\n",(0,t.jsxs)(i.li,{children:["Documents are created and changed with ",(0,t.jsx)(i.strong,{children:"Operations"}),", each operation changes the state of a document"]}),"\n",(0,t.jsx)(i.li,{children:"The first operation determines the beginning of a new document"}),"\n",(0,t.jsx)(i.li,{children:"Any other operation which is part of the same document changes its state"}),"\n",(0,t.jsx)(i.li,{children:"Many authors can contribute to one document"}),"\n"]}),"\n",(0,t.jsx)(i.h2,{id:"operations",children:"Operations"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["Every item in the linked-list is called an ",(0,t.jsx)(i.strong,{children:"Operation"})]}),"\n",(0,t.jsxs)(i.li,{children:["An operation consists of a ",(0,t.jsx)(i.strong,{children:"Header"})," and a ",(0,t.jsx)(i.strong,{children:"Body"})]}),"\n",(0,t.jsxs)(i.li,{children:["The header contains ",(0,t.jsx)(i.em,{children:"always"})," the following fields:","\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-rust",children:"struct Header {\n    /// Version of the operation format, currently `1`\n    version: u64,\n\n    /// Digital signature of this operation, p2panda uses Ed25519\n    signature: Signature,\n\n    /// Public key of the author of this operation\n    public_key: PublicKey,\n\n    /// Hash of the body of this operation, can be omitted if no body is given\n    payload_hash: Option<Hash>,\n\n    /// Number of bytes of the body of this operation, can be omitted if no body is given\n    payload_size: Option<u64>,\n\n    /// UNIX timestamp.  If not the first operation in the document it needs to\n    /// be larger or equal than the timestamp the operation points at via it's\n    /// `backlink` or `previous` link (see below)\n    timestamp: u64,\n\n    /// Number of operations this author has published to this document, begins\n    /// with `0` and is always incremented by `1` with each new operation by the\n    /// same author\n    seq_num: u64,\n}\n"})}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["The Body is not further defined, it can be any arbitrary bytes","\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-rust",children:"struct Body(Vec<u8>)\n"})}),"\n"]}),"\n",(0,t.jsx)(i.li,{children:"Since the header is stored separately from the body, the body can be deleted at any point without any consequences for the data type"}),"\n"]}),"\n",(0,t.jsx)(i.h2,{id:"creating-documents",children:"Creating documents"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["As soon as an operation is published it is considered a CREATE operation. CREATE operations define a new document","\n",(0,t.jsx)(o.Z,{title:"Creating a new Salmon Cake recipe document with a CREATE operation",url:n(6132)}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["The hash of this CREATE operation is used as the identifier of the whole document for its entire lifetime","\n",(0,t.jsx)(o.Z,{title:"Generating a hash from the operation header",url:n(5021)}),"\n"]}),"\n",(0,t.jsx)(i.li,{children:"This header of the CREATE operation should be kept for the lifetime of it's document, its signature is the proof of authorship for the owner (the owner can delegate capabilities later)"}),"\n"]}),"\n",(0,t.jsx)(i.h2,{id:"updating-documents",children:"Updating documents"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["If we want to refer to this document with another UPDATE operation, changing the state of a document, we add the following fields to the header:","\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-rust",children:'struct Header {\n    /// Hash of the previous operation of the same author\n    backlink: Hash,\n\n    /// Hash of the CREATE operation aka "document ID" we refer to with this update\n    document_id: Hash,\n\n    // ... plus same fields as above\n}\n'})}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["The ",(0,t.jsx)(i.code,{children:"seq_num"})," needs to be incremented by ",(0,t.jsx)(i.code,{children:"1"})," and the operation is appended to the author's log for this document"]}),"\n"]}),"\n",(0,t.jsx)(i.h2,{id:"collaboration",children:"Collaboration"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["If multiple users want to write to the same document, they refer to the same ",(0,t.jsx)(i.code,{children:"document_id"})," when publishing UPDATE operations"]}),"\n",(0,t.jsxs)(i.li,{children:["Here we have three different authors (Blue, Orange, Yellow) writing to the same document with ID ",(0,t.jsx)(i.code,{children:"0x2bac"})," which was created by Blue:","\n",(0,t.jsx)(o.Z,{title:"Writing to the same document which was created by the Blue author",url:n(6311)}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["By default it is not permitted to write to any document if you're not the original author. Through ",(0,t.jsx)(i.a,{href:"#capabilities",children:'"Capabilities"'})," we can add more authors, giving them the permission to write to your documents"]}),"\n"]}),"\n",(0,t.jsx)(i.h2,{id:"ordering",children:"Ordering"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"We need a way to determine which operations took place before others when collaborating on the same document"}),"\n",(0,t.jsxs)(i.li,{children:["Through adding ",(0,t.jsx)(i.code,{children:"previous"})," links in the operation header we can determine a causal order of ",(0,t.jsx)(i.em,{children:"which"})," operations were created ",(0,t.jsx)(i.em,{children:"before"})," others (similar to vector clocks):","\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-rust",children:'struct Header {\n    /// Optional list of hashes of the operations we refer to as the\n    /// "previous" ones. These are operations from other authors\n    previous: Option<Hash[]>,\n\n    // ... plus same fields as above\n}\n'})}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["We apply a topological sorting algorithm on top of the DAG formed by the ",(0,t.jsx)(i.code,{children:"previous"})," links to determine this ordering"]}),"\n",(0,t.jsx)(i.li,{children:'This algorithm sorts all operations of all authors from "earliest" to "latest", the last operation in this sorted list is the "last" write'}),"\n",(0,t.jsxs)(i.li,{children:["Using ",(0,t.jsx)(i.code,{children:"previous"})," links is optional as it depends on the application if this level of cryptographic security over ordering is required."]}),"\n",(0,t.jsxs)(i.li,{children:["When using ",(0,t.jsx)(i.code,{children:"previous"})," links the ",(0,t.jsx)(i.code,{children:"timestamp"})," fields become more secure as it is not allowed to publish an earlier timestamp than the previous one","\n",(0,t.jsx)(o.Z,{title:"Ordering operations of a document by previous links",url:n(1032)}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["If no ",(0,t.jsx)(i.code,{children:"previous"})," links have been given the ",(0,t.jsx)(i.code,{children:"timestamp"})," is used to determine the ordering","\n",(0,t.jsx)(o.Z,{title:"Ordering operations of a document by timestamp",url:n(4709)}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(i.h2,{id:"views",children:"Views"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["Document views represent the immutable state of a document at a particular point in its history of edits","\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"Every change of a document results in a new document view"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["A document view is identified by its set of graph tips: the document view id","\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"Each graph tip is represented as an operation id"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(i.li,{children:"It's possible to replicate the exact state of a document from the document view id, as long as the history was preserved"}),"\n",(0,t.jsxs)(i.li,{children:["Document views are required for ",(0,t.jsx)(i.code,{children:"previous"})," links, extensions, like capabilities or encryption"]}),"\n"]}),"\n",(0,t.jsx)(i.h2,{id:"forks",children:"Forks"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["If a peer observes duplicate ",(0,t.jsx)(i.code,{children:"backlink"})," and / or ",(0,t.jsx)(i.code,{children:"seq_num"})," fields, the ",(0,t.jsx)(i.code,{children:"timestamp"})," is picked as a tie-breaker, if the ",(0,t.jsx)(i.code,{children:"timestamp"})," is the same, the hash of the operation (operation ID) is picked as a tie-breaker, with the higher hash winning"]}),"\n",(0,t.jsx)(i.li,{children:"Accidental forks are not considered harmful to the system and can usually be resolved easily"}),"\n",(0,t.jsx)(i.li,{children:'Forks by malicious authors need to be actively managed and removed by the application using the capabilities system (see more under "Capabilities"), authors are always explicitly granted permission to contribute to a document, they can be removed after malicious behaviour was noticed'}),"\n"]}),"\n",(0,t.jsx)(o.Z,{title:"Example of a tolerated fork. We prefer the operation with the higher timestamp",url:n(5285)}),"\n",(0,t.jsx)(i.h2,{id:"history",children:"History"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["The latest operations (see ",(0,t.jsx)(i.a,{href:"#ordering",children:'"Ordering"'}),") of the set determine the latest state of the document"]}),"\n",(0,t.jsx)(i.li,{children:"Documents can contain the history of their changes by preserving older operations"}),"\n",(0,t.jsxs)(i.li,{children:["It is possible to retain all history, or just the latest ",(0,t.jsx)(i.code,{children:"n"})," operations for a document","\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Shallow documents"}),": only keep the latest ",(0,t.jsx)(i.code,{children:"n"})," operations","\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"As new operations arrive from each author, they replace older versions, these older operations can be garbage collected"}),"\n",(0,t.jsxs)(i.li,{children:["In this case causal ordering (",(0,t.jsx)(i.code,{children:"previous"})," links) between operations is sometimes lost and operation ordering falls-back to using ",(0,t.jsx)(i.code,{children:"timestamp"})]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Deep documents"}),": keep all causal history back to the document's CREATE operation","\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"This guarantees accurate, delay-tolerant ordering of operations"}),"\n",(0,t.jsx)(i.li,{children:"Garbage collection can still be performed on the body of operations"}),"\n",(0,t.jsx)(i.li,{children:"Headers are retained for the lifetime of the document"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:['Depending on the applications requirements documents with a "longer" history can securely guarantee ordering through the ',(0,t.jsx)(i.code,{children:"previous"})," links while more shallow documents need to rely more on insecure / forgeable timestamps"]}),"\n",(0,t.jsxs)(i.li,{children:["Example: Using a CRDT into the operation body (like ",(0,t.jsx)(i.a,{href:"https://docs.yjs.dev/",children:"YJS"})," documents, for collaborative text editing for example), you might be interested ",(0,t.jsx)(i.em,{children:"only"})," in the last operations per author and merge them to receive the latest document state:"]}),"\n"]}),"\n",(0,t.jsx)(o.Z,{title:"Document with maximum depth(1), useful for working with CRDTs like y-js",url:n(6185)}),"\n",(0,t.jsx)(i.h2,{id:"deletion",children:"Deletion"}),"\n",(0,t.jsx)(i.p,{children:"namakemono offers different forms of automatic or user-indented deletion, with various degrees of privacy as sometimes you do not want to keep traces of what data has been deleted by whom."}),"\n",(0,t.jsx)(i.h3,{id:"garbage-collection",children:"Garbage Collection"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"Garbage collection only takes place locally, other peers do not need to be informed about this decision"}),"\n"]}),"\n",(0,t.jsx)(i.h4,{id:"operations-1",children:"Operations"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["As already mentioned under ",(0,t.jsx)(i.a,{href:"#history",children:'"History"'})," we can limit the maximum amount of operations per document and per author"]}),"\n",(0,t.jsx)(i.li,{children:'"Useless" operations are removed instantly as soon as the new one arrives'}),"\n"]}),"\n",(0,t.jsx)(i.h4,{id:"documents-1",children:"Documents"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"Some documents are only retained when they are referenced by other documents, or if a reference they contain is still alive"}),"\n",(0,t.jsx)(i.li,{children:"When references expire, documents or entire collections can be automatically garbage collected\nwithout leaving a trace"}),"\n",(0,t.jsxs)(i.li,{children:["See ",(0,t.jsx)(i.a,{href:"#collections",children:'"Collections"'})," for an example"]}),"\n"]}),"\n",(0,t.jsx)(i.h3,{id:"tombstones",children:"Tombstones"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["To delete a single document we can publish a ",(0,t.jsx)(i.strong,{children:"Tombstone"})," operation which will cause all operations for this document to be deleted"]}),"\n",(0,t.jsx)(i.li,{children:'This tombstone is sent other peers to inform them that we want this document to be deleted. To\nensure the document remains deleted network wide, the tombstone should be kept until the\ndocument is "dropped" via garbage collection'}),"\n",(0,t.jsxs)(i.li,{children:["If we want to delete / tombstone the document we add the action field inside the header, no body is required","\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-rust",children:'struct Header {\n    /// Needs to be set to "true" to tombstone this document\n    tombstone: Option<bool>,\n\n    // .. plus all other header fields\n}\n'})}),"\n"]}),"\n",(0,t.jsx)(i.li,{children:"As soon as we've observed at least one tombstone operation inside a document we do not accept any other further operations"}),"\n",(0,t.jsxs)(i.li,{children:["If references expire as a result of document deletion then then any effected documents should also be deleted (see ",(0,t.jsx)(i.a,{href:"#garbage-collection",children:'"Garbage Collection"'}),")"]}),"\n"]}),"\n",(0,t.jsx)(i.h2,{id:"extensions",children:"Extensions"}),"\n",(0,t.jsx)(i.p,{children:"Operations can be extended with certain features we usually want for high-level application concerns, like permission, encryption or defining data hierarchies. For this the header can be extended with additional informations."}),"\n",(0,t.jsx)(i.h3,{id:"ephemeral-documents",children:"Ephemeral documents"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:'Documents can be defined as "ephemeral", giving an expiry date after which all their operations should be deleted'}),"\n",(0,t.jsx)(i.li,{children:"No tombstones are needed for this sort of deletion"}),"\n",(0,t.jsxs)(i.li,{children:["The following field is added to the header:","\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-rust",children:"struct Header {\n    /// UNIX timestamp\n    delete_after: Option<u64>,\n\n    // .. plus all other header fields\n}\n"})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(i.h3,{id:"schemas",children:"Schemas"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"Schemas are documents which can be used to verify that an operation or document following that schema is respecting a certain format"}),"\n",(0,t.jsx)(i.li,{children:"Other documents can refer to that schema to indicate that they comply with this format"}),"\n",(0,t.jsxs)(i.li,{children:["We can do this by adding an extension field in the operation header:","\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-rust",children:"struct Header {\n    /// Document View ID of the schema document\n    schema_id: Option<Hash[]>,\n\n    // .. plus all other header fields\n}\n"})}),"\n"]}),"\n",(0,t.jsx)(i.li,{children:'Document view ids are lists of all operation ids we want to refer to to "reconstruct" exactly this version of the document. This is required for deterministic behaviour and supporting schema "migrations"'}),"\n",(0,t.jsx)(i.li,{children:'We distinguish between "system schemas" and "application schemas"'}),"\n",(0,t.jsx)(i.li,{children:"System schemas are determined by this very specification and usually serve low-level purposes like handling permissions etc. while application schemas are defined by application developers"}),"\n",(0,t.jsx)(i.li,{children:"Application schemas are not further defined and can follow different sorts of schema / validation techniques, depending on the application data"}),"\n",(0,t.jsx)(i.li,{children:"Nodes can identify schemas of documents and validate them accordingly, reject operations which do not follow the given schema correctly"}),"\n"]}),"\n",(0,t.jsx)(i.h3,{id:"collections",children:"Collections"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"Sometimes we want to express multiple documents to be part of the same collection"}),"\n",(0,t.jsxs)(i.li,{children:["We can do this by publishing a ",(0,t.jsx)(i.strong,{children:"Collection"})," document and then adding an extension field in the operation of each document to assign it to this collection"]}),"\n",(0,t.jsxs)(i.li,{children:["To create a collection document we publish a CREATE operation with the following ",(0,t.jsx)(i.code,{children:"schema_id"})," header","\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"schema_id"}),": ",(0,t.jsx)(i.code,{children:"collections_v1"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"System schema identifier for collection documents"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["To refer to this collection document we refer to it using the document id in the header","\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-rust",children:"struct Header {\n    /// Document View ID of the collection document\n    collection: Option<Hash>,\n\n    // .. plus all other header fields\n}\n"})}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["If a tombstone operation for a collection document was published, ",(0,t.jsx)(i.em,{children:"all"})," related documents get deleted as well"]}),"\n",(0,t.jsxs)(i.li,{children:['Collection documents can again refer to "parent" collection documents',"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"This allows for neat application patterns to design document and collection hierarchies"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["Together with capabilities and collections we can express complex hierarchies of permissions. We can grant CREATE capabilities to allow publishing new documents in a collection, or think of groupings to express admins, roles and moderators etc.","\n",(0,t.jsx)(o.Z,{title:"Collections help to structure application data, moderation roles, permissions and hierarchies",url:n(5713)}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(i.h3,{id:"capabilities",children:"Capabilities"}),"\n",(0,t.jsx)(i.admonition,{type:"note",children:(0,t.jsxs)(i.p,{children:["Capabilities are in the workings for 2024. Read our specification here: ",(0,t.jsx)(i.a,{href:"https://github.com/p2panda/access-control",children:"https://github.com/p2panda/access-control"})]})}),"\n",(0,t.jsx)(i.h3,{id:"encryption",children:"Encryption"}),"\n",(0,t.jsx)(i.admonition,{type:"note",children:(0,t.jsxs)(i.p,{children:['Encryption is mostly handled by decentralized continuous group key agreement (DCGKA) and our "Secret Group" specification which is heavily in the workings in our roadmap 2024, allowing offline-first PCS and FS double-ratchet encryption or "long-living" symmetrical encryption. You can read the paper ',(0,t.jsx)(i.a,{href:"https://eprint.iacr.org/2020/1281.pdf",children:"https://eprint.iacr.org/2020/1281.pdf"})," for more information around the approach we implement."]})}),"\n",(0,t.jsx)(i.h2,{id:"replication",children:"Replication"})]})}function p(e={}){const{wrapper:i}={...(0,s.a)(),...e.components};return i?(0,t.jsx)(i,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},2233:(e,i,n)=>{"use strict";n.d(i,{Z:()=>a});n(7294);var t=n(5944);const s={"image-frame":"image-frame_fg61","image-frame-inner":"image-frame-inner_Xabn","image-frame-title":"image-frame-title_UNlE"};var o=n(5893);function a(e){let{title:i,url:n}=e;return n?(0,o.jsxs)("div",{className:s["image-frame"],children:[(0,o.jsx)("div",{className:s["image-frame-inner"],children:(0,o.jsx)(t.Z,{alt:i,title:i,img:n})}),i&&(0,o.jsx)("div",{className:s["image-frame-title"],children:i})]}):null}}}]);