<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-specifications/namakemono/index" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.0">
<title data-rh="true">namakemono | p2panda</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://p2panda.org/specifications/namakemono/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="namakemono | p2panda"><meta data-rh="true" name="description" content="ü¶• namakemono = Sloth (Japanese) = Slow and forgetful = very delay-tolerant, offline-first and privacy-respecting ü©∑"><meta data-rh="true" property="og:description" content="ü¶• namakemono = Sloth (Japanese) = Slow and forgetful = very delay-tolerant, offline-first and privacy-respecting ü©∑"><link data-rh="true" rel="icon" href="/images/deepsea-panda.svg"><link data-rh="true" rel="canonical" href="https://p2panda.org/specifications/namakemono/"><link data-rh="true" rel="alternate" href="https://p2panda.org/specifications/namakemono/" hreflang="en"><link data-rh="true" rel="alternate" href="https://p2panda.org/specifications/namakemono/" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="p2panda News RSS Feed"><link rel="stylesheet" href="/assets/css/styles.862b1275.css">
<script src="/assets/js/runtime~main.c81b6c81.js" defer="defer"></script>
<script src="/assets/js/main.97848bd4.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><div class="navbar__brand"><div class="navbar__logo"><img src="/images/p2panda-book.png" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/images/p2panda-book.png" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></div></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/images/p2panda-book.png" alt="p2panda Handbook" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/images/p2panda-book.png" alt="p2panda Handbook" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a class="navbar__item navbar__link" href="/about/">About</a><a class="navbar__item navbar__link" href="/learn/">Learn</a><a class="navbar__item navbar__link" href="/tutorials/">Tutorials</a><a class="navbar__item navbar__link" href="/sdks/">SDKs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/specifications/">Specifications</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/faq">FAQ</a><a class="navbar__item navbar__link" href="/links">Links</a><a class="navbar__item navbar__link" href="/contact">Contact</a><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/"><img src="/images/p2panda-book.png" alt="p2panda Handbook" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/images/p2panda-book.png" alt="p2panda Handbook" class="themedComponent_mlkZ themedComponent--dark_xIcU"></a><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/specifications/">Specifications</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/specifications/namakemono/">namakemono</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/specifications/aquadoggo/">aquadoggo API</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><img src="/images/deepsea-panda.svg" width="30" class="icon-home_wWeS"></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">namakemono</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>namakemono</h1></header><blockquote>
<p>ü¶• namakemono = Sloth (Japanese) = Slow and forgetful = very delay-tolerant, offline-first and privacy-respecting ü©∑</p>
</blockquote>
<p><strong>namakemono</strong> is a protocol for peer-to-peer and federated applications. It gives them sloth-superpowers: offline-first collaboration, fine-grained permissions, data validation, schema migration, decentralised MLS encryption, low memory footprint, efficient replication and privacy-respecting deletion.</p>
<div class="image-frame_fg61"><div class="image-frame-inner_Xabn"><div style="background-size:cover;background-repeat:no-repeat;position:relative;background-image:url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAGCAYAAAD68A/GAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAx0lEQVR4nBXKy06DQABAUf7/h9SViQssD5uGKo8ORBgotDBMByqvdHFNF2d3LLM8GOeFvvFRlYOqPRp9pb4ZmjBBOj5tKLB0I1FlirnE6L4hlxI7FOwOCcV3hRIdujNYbfhJ4b8zVILz9YHvar72imI/kH7UVIHG3Dcs0yuGXnE857yGMU5+ofydcN8y3JeMtpq4r884bQzzxknf8EpJEP8go5QsaBHHDtuL8MMUy/wtPA3TyjivlCIjT06M04KZV+xDxC5I+AcT+drDsMTJJAAAAABJRU5ErkJggg==&quot;)"><svg style="width:100%;height:auto;max-width:100%;margin-bottom:-4px" width="1478" height="868"></svg><noscript><img style="width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0" src="/assets/ideal-img/extensions.20522a4.1478.png" srcset="/assets/ideal-img/extensions.20522a4.1478.png 1478w" alt="Sloth-Superpowers!" width="1478" height="868"></noscript></div></div><div class="image-frame-title_UNlE">Sloth-Superpowers!</div></div>
<p><strong>namakemono</strong> was designed to solve common privacy- and efficiency problems when building collaborative applications in peer-to-peer systems. This includes:</p>
<ul>
<li><strong>Offline-first collaboration:</strong> Create and edit data with others, even when you&#x27;re offline. Distributed systems usually compromise on &quot;how long&quot; you can be offline, namakemono gives you the tools to stay offline as long as you want</li>
<li><strong>Fine-grained capabilities:</strong> Full control over your data by defining who can sync, create, update or delete what. Usually capability system require nodes to be online, namakemono allows capabilities to be offline-first</li>
<li><strong>End-to-end encryption:</strong> Secure and scaleable group encryption with a decentralised variant of the Messaging-Layer-Security (MLS) protocol</li>
<li><strong>Don&#x27;t grow data forever, except if you want to:</strong> Keep the history of all changes if you need them, or delete old data instantly when your application does not require it, even of other authors</li>
<li><strong>Hybrid networks:</strong> Use namakemono in both peer-to-peer or federated networks, or even both of them at the same time</li>
<li><strong>Privacy-respecting deletion:</strong> Delete whole collections of data with one tombstone or let data disappear by itself, giving it an expiry date</li>
<li><strong>Schemas:</strong> Define and distribute versioned and migratable schemas of your choice to validate incoming data</li>
<li><strong>Collections:</strong> Structure hierarchies of data collections, combining them with permissions to model user-roles, moderation, admin access and more typical application concerns</li>
<li><strong>Re-use your key-pair:</strong> .. on multiple devices without being afraid of accidental forks</li>
<li><strong>Efficient and partial sync:</strong> namakemono is still a linked-list and can leverage from fast, simple and efficient log-replication</li>
<li><strong>Flexible:</strong> Use any CRDT, database, transport, data validation format, encoding, digital signature algorithm or hashing algorithm you want!</li>
</ul>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><span class="panda-icon">üêß</span></span>Status: Draft</div><div class="admonitionContent_BuS1"><p>namakemono is based on the original p2panda specification and can be seen as the next, simplified iteration. It helps us to leverage from the best parts we&#x27;ve came up with so far over the last years, separate application concerns more from the protocol (&quot;bring your own CRDT&quot;) and remove the Bamboo append-only log data type (as we realized we haven&#x27;t used it in the form it was designed for).</p><p>If you have any comments or feedback on this specification. Please <a href="/contact">contact us</a>!</p></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="short-overview">Short overview<a href="#short-overview" class="hash-link" aria-label="Direct link to Short overview" title="Direct link to Short overview">‚Äã</a></h2>
<div class="image-frame_fg61"><div class="image-frame-inner_Xabn"><div style="background-size:cover;background-repeat:no-repeat;position:relative;background-image:url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAABCAYAAADn9T9+AAAACXBIWXMAAAsTAAALEwEAmpwYAAAANElEQVR4nAEpANb/APf17Ix5hW4X9fX1TeXg1GUAAGYF8fHmh3N/cxbz8/BZ4d7MVjw8SBX/NxcsTgE21AAAAABJRU5ErkJggg==&quot;)"><svg style="width:100%;height:auto;max-width:100%;margin-bottom:-4px" width="1150" height="154"></svg><noscript><img style="width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0" src="/assets/ideal-img/linked-list.182b507.1150.png" srcset="/assets/ideal-img/linked-list.182b507.1150.png 1150w" alt="namakemono is a little bit like a typical append-only log, secured by signatures and cryptographic backlinks, but with a few tricks!" width="1150" height="154"></noscript></div></div><div class="image-frame-title_UNlE">namakemono is a little bit like a typical append-only log, secured by signatures and cryptographic backlinks, but with a few tricks!</div></div>
<div class="image-frame_fg61"><div class="image-frame-inner_Xabn"><div style="background-size:cover;background-repeat:no-repeat;position:relative;background-image:url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAECAYAAAC3OK7NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAjUlEQVR4nGP48uXNMm9vG8Gvnz8WPrp/JfLWrZfKr18+aunvny/w/ev79k2bZoowMDCwMjx/cEJxZn091/PnF8RWzS4U+vD9v/LTpzcbuqZMkfjy8UnJ0qUghTKcDDDw//9/Rigt8uzRWY8zZ85wff38um3VqrmiYBNxgf///7N9ev8gedXseiEGBgY2ANYeRrL5cv6fAAAAAElFTkSuQmCC&quot;)"><svg style="width:100%;height:auto;max-width:100%;margin-bottom:-4px" width="1214" height="458"></svg><noscript><img style="width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0" src="/assets/ideal-img/log-depth.5acc26d.1214.png" srcset="/assets/ideal-img/log-depth.5acc26d.1214.png 1214w" alt="Old data in the log + metadata can be removed directly as soon as new data arrives! How much history you want to keep is configurable" width="1214" height="458"></noscript></div></div><div class="image-frame-title_UNlE">Old data in the log + metadata can be removed directly as soon as new data arrives! How much history you want to keep is configurable</div></div>
<div class="image-frame_fg61"><div class="image-frame-inner_Xabn"><div style="background-size:cover;background-repeat:no-repeat;position:relative;background-image:url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAADCAYAAACqPZ51AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAcElEQVR4nGP4//8/EwMDA8OvX18Lr107YfH9+xf3O/fvJNjl9/tt27aNnYGBgREkz/D//38w4/Lls5otLQWSn9+/drx882yQe9Us/56eHrX9+/ezgBXCwKpVq5hB9NsX9y1v3jzm0rn6kPP++nq4IgBpDTE3qd7q1AAAAABJRU5ErkJggg==&quot;)"><svg style="width:100%;height:auto;max-width:100%;margin-bottom:-4px" width="1310" height="328"></svg><noscript><img style="width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0" src="/assets/ideal-img/key-reuse.4cc0cd6.1310.png" srcset="/assets/ideal-img/key-reuse.4cc0cd6.1310.png 1310w" alt="Key pair reuse across multiple devices and accidental forks are tolerated" width="1310" height="328"></noscript></div></div><div class="image-frame-title_UNlE">Key pair reuse across multiple devices and accidental forks are tolerated</div></div>
<div class="image-frame_fg61"><div class="image-frame-inner_Xabn"><div style="background-size:cover;background-repeat:no-repeat;position:relative;background-image:url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAICAYAAADA+m62AAAACXBIWXMAAAsTAAALEwEAmpwYAAABCUlEQVR4nB2PzUrDQBhF82I+QYv6CD6cS8Gle3EhNIlYsAFLUNtJ06TNZP4nP/PNlXZxVvdw4SSv7+n9W/r5wI7HW2nMouVyWbd8WXO+5HJYnLi9q1p+kwjjiwjADBMJ42CHEX4O8BNBGU0URwg75BdxE+OMQ1XSoRXQ1kP2FdabLZrditA9o9MhT3pti5kCetFRrxy081BGoK4b/LYtlUZCKncRXRFoBGPfVDUCyhjw7g/ltkTO9vTS7mG1vz5u/DRDaBmk9dH6MSotI6tYLHbnkO4naGuzZA5UAAABFABcwrxrUNcMP2dHH6frmied0E9C2bVQNhXKZvyKyrSfMuf9avL2q5Pm8R8OOSSeQ83TAgAAAABJRU5ErkJggg==&quot;)"><svg style="width:100%;height:auto;max-width:100%;margin-bottom:-4px" width="848" height="676"></svg><noscript><img style="width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0" src="/assets/ideal-img/document.66bea05.848.png" srcset="/assets/ideal-img/document.66bea05.848.png 848w" alt="Multiple authors can collaborate on the same document - in this example with maximum depth(2)" width="848" height="676"></noscript></div></div><div class="image-frame-title_UNlE">Multiple authors can collaborate on the same document - in this example with maximum depth(2)</div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="encoding--cryptographic-primitives">Encoding &amp; Cryptographic Primitives<a href="#encoding--cryptographic-primitives" class="hash-link" aria-label="Direct link to Encoding &amp; Cryptographic Primitives" title="Direct link to Encoding &amp; Cryptographic Primitives">‚Äã</a></h2>
<ul>
<li>Namakemono works theoretically with any data encoding, digital signature algorithm (DSA) or hashing algorithm</li>
<li>We recommend <strong>Ed25519</strong> for signatures, <strong>BLAKE3</strong> for hashing and <strong>CBOR</strong> for encoding</li>
</ul>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="documents">Documents<a href="#documents" class="hash-link" aria-label="Direct link to Documents" title="Direct link to Documents">‚Äã</a></h2>
<ul>
<li><strong>Documents</strong> is how we distinguish one piece of data from another</li>
<li>Documents are created and changed with <strong>Operations</strong>, each operation changes the state of a document</li>
<li>The first operation determines the beginning of a new document</li>
<li>Any other operation which is part of the same document changes its state</li>
<li>Many authors can contribute to one document</li>
</ul>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="operations">Operations<a href="#operations" class="hash-link" aria-label="Direct link to Operations" title="Direct link to Operations">‚Äã</a></h2>
<ul>
<li>Every item in the linked-list is called an <strong>Operation</strong></li>
<li>An operation consists of a <strong>Header</strong> and a <strong>Body</strong></li>
<li>The header contains <em>always</em> the following fields:<!-- -->
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d3d0c8;--prism-background-color:#2d2d2d"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#d3d0c8;background-color:#2d2d2d"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d3d0c8"><span class="token keyword" style="color:#ffcc66">struct</span><span class="token plain"> </span><span class="token type-definition class-name" style="color:#9ddab3">Header</span><span class="token plain"> </span><span class="token punctuation" style="color:#f2f0ec">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">    </span><span class="token comment" style="color:#66cccc">/// Version of the operation format, currently `1`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">    version</span><span class="token punctuation" style="color:#f2f0ec">:</span><span class="token plain"> </span><span class="token keyword" style="color:#ffcc66">u64</span><span class="token punctuation" style="color:#f2f0ec">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">    </span><span class="token comment" style="color:#66cccc">/// Digital signature of this operation, p2panda uses Ed25519</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">    signature</span><span class="token punctuation" style="color:#f2f0ec">:</span><span class="token plain"> </span><span class="token class-name" style="color:#9ddab3">Signature</span><span class="token punctuation" style="color:#f2f0ec">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">    </span><span class="token comment" style="color:#66cccc">/// Public key of the author of this operation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">    public_key</span><span class="token punctuation" style="color:#f2f0ec">:</span><span class="token plain"> </span><span class="token class-name" style="color:#9ddab3">PublicKey</span><span class="token punctuation" style="color:#f2f0ec">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">    </span><span class="token comment" style="color:#66cccc">/// Hash of the body of this operation, can be omitted if no body is given</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">    payload_hash</span><span class="token punctuation" style="color:#f2f0ec">:</span><span class="token plain"> </span><span class="token class-name" style="color:#9ddab3">Option</span><span class="token operator" style="color:#f2f0ec">&lt;</span><span class="token class-name" style="color:#9ddab3">Hash</span><span class="token operator" style="color:#f2f0ec">&gt;</span><span class="token punctuation" style="color:#f2f0ec">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">    </span><span class="token comment" style="color:#66cccc">/// Number of bytes of the body of this operation, can be omitted if no body is given</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">    payload_size</span><span class="token punctuation" style="color:#f2f0ec">:</span><span class="token plain"> </span><span class="token class-name" style="color:#9ddab3">Option</span><span class="token operator" style="color:#f2f0ec">&lt;</span><span class="token keyword" style="color:#ffcc66">u64</span><span class="token operator" style="color:#f2f0ec">&gt;</span><span class="token punctuation" style="color:#f2f0ec">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">    </span><span class="token comment" style="color:#66cccc">/// UNIX timestamp.  If not the first operation in the document it needs to</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">    </span><span class="token comment" style="color:#66cccc">/// be larger or equal than the timestamp the operation points at via it&#x27;s</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">    </span><span class="token comment" style="color:#66cccc">/// `backlink` or `previous` link (see below)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">    timestamp</span><span class="token punctuation" style="color:#f2f0ec">:</span><span class="token plain"> </span><span class="token keyword" style="color:#ffcc66">u64</span><span class="token punctuation" style="color:#f2f0ec">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">    </span><span class="token comment" style="color:#66cccc">/// Number of operations this author has published to this document, begins</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">    </span><span class="token comment" style="color:#66cccc">/// with `0` and is always incremented by `1` with each new operation by the</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">    </span><span class="token comment" style="color:#66cccc">/// same author</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">    seq_num</span><span class="token punctuation" style="color:#f2f0ec">:</span><span class="token plain"> </span><span class="token keyword" style="color:#ffcc66">u64</span><span class="token punctuation" style="color:#f2f0ec">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain"></span><span class="token punctuation" style="color:#f2f0ec">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>The Body is not further defined, it can be any arbitrary bytes<!-- -->
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d3d0c8;--prism-background-color:#2d2d2d"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#d3d0c8;background-color:#2d2d2d"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d3d0c8"><span class="token keyword" style="color:#ffcc66">struct</span><span class="token plain"> </span><span class="token type-definition class-name" style="color:#9ddab3">Body</span><span class="token punctuation" style="color:#f2f0ec">(</span><span class="token class-name" style="color:#9ddab3">Vec</span><span class="token operator" style="color:#f2f0ec">&lt;</span><span class="token keyword" style="color:#ffcc66">u8</span><span class="token operator" style="color:#f2f0ec">&gt;</span><span class="token punctuation" style="color:#f2f0ec">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>Since the header is stored separately from the body, the body can be deleted at any point without any consequences for the data type</li>
</ul>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="creating-documents">Creating documents<a href="#creating-documents" class="hash-link" aria-label="Direct link to Creating documents" title="Direct link to Creating documents">‚Äã</a></h2>
<ul>
<li>As soon as an operation is published it is considered a CREATE operation. CREATE operations define a new document<!-- -->
<div class="image-frame_fg61"><div class="image-frame-inner_Xabn"><div style="background-size:cover;background-repeat:no-repeat;position:relative;background-image:url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAJCAYAAAALpr0TAAAACXBIWXMAAAsTAAALEwEAmpwYAAABBElEQVR4nGXPzUrDQBSG4WmXViyCboTiBfQicyHuBLsQQSL+IFJFChZi60IUNQuL2naSZiahmcnJnEnCEXe1+dYPH7yMMcaIqEkEHSLq9Fy3e9UfdIloP4uiPbY6ItrIMrie8nBsrT0yBu9lkn4YUxwSUWMVtpZKe/NQTBTAJQC+yiSVgPasBlOd3U7ni2dEewzGDEMRfxprezWoNXjBQkzQ2oulhpcfHgmdo1uDiMWAh/K9rKpTBflYJukMcjxZh404jttE1L4bjXaefH+XiLZ9Ibb+VXPOWwbtTZ6b4YwH3iISDwbxsajoYP1xE23xluosUFp/K6W/AIwsy/LccZzmH/oFTgHomJ2RtPcAAAAASUVORK5CYII=&quot;)"><svg style="width:100%;height:auto;max-width:100%;margin-bottom:-4px" width="1280" height="1098"></svg><noscript><img style="width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0" src="/assets/ideal-img/operation-example.127ea02.1280.png" srcset="/assets/ideal-img/operation-example.127ea02.1280.png 1280w" alt="Creating a new Salmon Cake recipe document with a CREATE operation" width="1280" height="1098"></noscript></div></div><div class="image-frame-title_UNlE">Creating a new Salmon Cake recipe document with a CREATE operation</div></div>
</li>
<li>The hash of this CREATE operation is used as the identifier of the whole document for its entire lifetime<!-- -->
<div class="image-frame_fg61"><div class="image-frame-inner_Xabn"><div style="background-size:cover;background-repeat:no-repeat;position:relative;background-image:url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAACCAYAAABhYU3QAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAQklEQVR4nGNgYGBg+P//P/e379/P/Pj58/SqVavkPn78XPD9x8/Pf/78SYPKs4BosMKv376f+f79B1zht+8/UBQCAEoGNAA9o/kZAAAAAElFTkSuQmCC&quot;)"><svg style="width:100%;height:auto;max-width:100%;margin-bottom:-4px" width="1280" height="200"></svg><noscript><img style="width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0" src="/assets/ideal-img/hashing.9b6b69d.1280.png" srcset="/assets/ideal-img/hashing.9b6b69d.1280.png 1280w" alt="Generating a hash from the operation header" width="1280" height="200"></noscript></div></div><div class="image-frame-title_UNlE">Generating a hash from the operation header</div></div>
</li>
<li>This header of the CREATE operation should be kept for the lifetime of it&#x27;s document, its signature is the proof of authorship for the owner (the owner can delegate capabilities later)</li>
</ul>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="updating-documents">Updating documents<a href="#updating-documents" class="hash-link" aria-label="Direct link to Updating documents" title="Direct link to Updating documents">‚Äã</a></h2>
<ul>
<li>If we want to refer to this document with another UPDATE operation, changing the state of a document, we add the following fields to the header:<!-- -->
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d3d0c8;--prism-background-color:#2d2d2d"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#d3d0c8;background-color:#2d2d2d"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d3d0c8"><span class="token keyword" style="color:#ffcc66">struct</span><span class="token plain"> </span><span class="token type-definition class-name" style="color:#9ddab3">Header</span><span class="token plain"> </span><span class="token punctuation" style="color:#f2f0ec">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">    </span><span class="token comment" style="color:#66cccc">/// Hash of the previous operation of the same author</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">    backlink</span><span class="token punctuation" style="color:#f2f0ec">:</span><span class="token plain"> </span><span class="token class-name" style="color:#9ddab3">Hash</span><span class="token punctuation" style="color:#f2f0ec">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">    </span><span class="token comment" style="color:#66cccc">/// Hash of the CREATE operation aka &quot;document ID&quot; we refer to with this update</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">    document_id</span><span class="token punctuation" style="color:#f2f0ec">:</span><span class="token plain"> </span><span class="token class-name" style="color:#9ddab3">Hash</span><span class="token punctuation" style="color:#f2f0ec">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">    </span><span class="token comment" style="color:#66cccc">// ... plus same fields as above</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain"></span><span class="token punctuation" style="color:#f2f0ec">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>The <code>seq_num</code> needs to be incremented by <code>1</code> and the operation is appended to the author&#x27;s log for this document</li>
</ul>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="collaboration">Collaboration<a href="#collaboration" class="hash-link" aria-label="Direct link to Collaboration" title="Direct link to Collaboration">‚Äã</a></h2>
<ul>
<li>If multiple users want to write to the same document, they refer to the same <code>document_id</code> when publishing UPDATE operations</li>
<li>Here we have three different authors (Blue, Orange, Yellow) writing to the same document with ID <code>0x2bac</code> which was created by Blue:<!-- -->
<div class="image-frame_fg61"><div class="image-frame-inner_Xabn"><div style="background-size:cover;background-repeat:no-repeat;position:relative;background-image:url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAHCAYAAAAxrNxjAAAACXBIWXMAAAsTAAALEwEAmpwYAAABB0lEQVR4nGOw948XqG6eIl9fX8/EwMDAUF5ezj9nzhxeELu+3p5l4sRWURCbQb/9ylnLjnPPpNuf7jnf4l/+uMXu4f1Ghweve03L3x1U3nN3vfKDD/tUjzLotl9vMm87O1u2/WHD6UZf//vNDrNvNTjPftFjFvBqn1LbjTUqC9/sVulh0Ou4Otu648xW2fbHU881ecc9bLLbfq/ZcdfLJvMgkI3/V4UyQ6xuu7zapuPUYaWOB0uPNvjHPmhxXH+r2WXL00Yrf5D8lVVabP//M4Ddz/C/HsJ43mhufq/Jof5ek109iI0sx8Dw/z/jmZlprCDm00bLipfdrv9fdrn+B7EhCu1ZQOoAPfh2LJ8ZAEUAAAAASUVORK5CYII=&quot;)"><svg style="width:100%;height:auto;max-width:100%;margin-bottom:-4px" width="940" height="658"></svg><noscript><img style="width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0" src="/assets/ideal-img/collaboration.827c036.940.png" srcset="/assets/ideal-img/collaboration.827c036.940.png 940w" alt="Writing to the same document which was created by the Blue author" width="940" height="658"></noscript></div></div><div class="image-frame-title_UNlE">Writing to the same document which was created by the Blue author</div></div>
</li>
<li>By default it is not permitted to write to any document if you&#x27;re not the original author. Through <a href="#capabilities">&quot;Capabilities&quot;</a> we can add more authors, giving them the permission to write to your documents</li>
</ul>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ordering">Ordering<a href="#ordering" class="hash-link" aria-label="Direct link to Ordering" title="Direct link to Ordering">‚Äã</a></h2>
<ul>
<li>We need a way to determine which operations took place before others when collaborating on the same document</li>
<li>Through adding <code>previous</code> links in the operation header we can determine a causal order of <em>which</em> operations were created <em>before</em> others (similar to vector clocks):<!-- -->
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d3d0c8;--prism-background-color:#2d2d2d"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#d3d0c8;background-color:#2d2d2d"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d3d0c8"><span class="token keyword" style="color:#ffcc66">struct</span><span class="token plain"> </span><span class="token type-definition class-name" style="color:#9ddab3">Header</span><span class="token plain"> </span><span class="token punctuation" style="color:#f2f0ec">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">    </span><span class="token comment" style="color:#66cccc">/// Optional list of hashes of the operations we refer to as the</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">    </span><span class="token comment" style="color:#66cccc">/// &quot;previous&quot; ones. These are operations from other authors</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">    previous</span><span class="token punctuation" style="color:#f2f0ec">:</span><span class="token plain"> </span><span class="token class-name" style="color:#9ddab3">Option</span><span class="token operator" style="color:#f2f0ec">&lt;</span><span class="token class-name" style="color:#9ddab3">Hash</span><span class="token punctuation" style="color:#f2f0ec">[</span><span class="token punctuation" style="color:#f2f0ec">]</span><span class="token operator" style="color:#f2f0ec">&gt;</span><span class="token punctuation" style="color:#f2f0ec">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">    </span><span class="token comment" style="color:#66cccc">// ... plus same fields as above</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain"></span><span class="token punctuation" style="color:#f2f0ec">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>We apply a topological sorting algorithm on top of the DAG formed by the <code>previous</code> links to determine this ordering</li>
<li>This algorithm sorts all operations of all authors from &quot;earliest&quot; to &quot;latest&quot;, the last operation in this sorted list is the &quot;last&quot; write</li>
<li>Using <code>previous</code> links is optional as it depends on the application if this level of cryptographic security over ordering is required.</li>
<li>When using <code>previous</code> links the <code>timestamp</code> fields become more secure as it is not allowed to publish an earlier timestamp than the previous one<!-- -->
<div class="image-frame_fg61"><div class="image-frame-inner_Xabn"><div style="background-size:cover;background-repeat:no-repeat;position:relative;background-image:url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAANCAYAAACQN/8FAAAACXBIWXMAAAsTAAALEwEAmpwYAAABdUlEQVR4nGPQab9x2aLjwmu99ssfNdtv+DMwMDCErvrPDKJRgFr9DQ3bjtNmJu0XDJU67vJDRP8zYijU7bi+wqLz/F79tssHdTpv2YMFQ1dhmqjbdmW/dceZG4Ztl26pdNx1xakQBP4zMDAe6w3l/D9Rhf1+vT3HlXotNrAEMpg5M40VRD9ptMq43+r0+l6L06NnzVbLMRT+r7dnAdFPG8zz77c4/7vT4vLjUZPNLob6/0xQJage+1/PwLQpzZhrfn28wH57Bpb6+ol8/8+ksf7/z8AIkmP4vyoU7PAXTRZRD1ucLtxpdT7/pMa68/thDddnO1Qv3l2vcvbzAZUNcKufN1mUvulx//+02+P/oxqbTf9Pq4e82qX+/856tf8f9qrch1u9v16e40Kxpdj+eg+Z66XqvIsWZYjd3W0t93KLqMSnQyqicKufN1qGPmxxPHK3xfnAkyabfob6ephnUH39vt2q9PMEj/8vezz/v22zPYDuYwCJVqLAaJzhqgAAAABJRU5ErkJggg==&quot;)"><svg style="width:100%;height:auto;max-width:100%;margin-bottom:-4px" width="1710" height="2283"></svg><noscript><img style="width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0" src="/assets/ideal-img/previous-ordering.e5609bd.1710.png" srcset="/assets/ideal-img/previous-ordering.e5609bd.1710.png 1710w" alt="Ordering operations of a document by previous links" width="1710" height="2283"></noscript></div></div><div class="image-frame-title_UNlE">Ordering operations of a document by previous links</div></div>
</li>
<li>If no <code>previous</code> links have been given the <code>timestamp</code> is used to determine the ordering<!-- -->
<div class="image-frame_fg61"><div class="image-frame-inner_Xabn"><div style="background-size:cover;background-repeat:no-repeat;position:relative;background-image:url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAACXBIWXMAAAsTAAALEwEAmpwYAAABUklEQVR4nGNgYGBg0Kw/7WXcfmGqdtvl9tiFd12+f37b8PP334n///9PYkAGum03ssw7Lr7Ubzl/I3np/cz///+e+PHr99v////PhyphBJNSrc8yNTvvPlFou3fFb+GrpP//f8z79uPnvv///9ejmLiuPi1jdVPOg1X16Zf2z2pJ+Pz7/9Q3H75u+fHjVwWKwg+t+tmvO6yev2o1vvFlbmTil///+798+b7ux49fJSgKf5xSyb+/Q/nz411yj75eDsl6/Obv5pfv3l/7+fN3P4rC94sNUh7MNr71eJbu6fdbYhIevfmx8vX7Tye///zZjqLwaY11/v0G10/3q+0ePp+Rkf3y6999Hz5+evT379/pqAobLQrutTh+ud9o9fj5rJTsp5/+bHv59v3Nb99+TEJV2GzldrfdbebdOqvuN2sbAx+++vjg8Ys3/z9/+bIWFo4A3J7GJJfnrPIAAAAASUVORK5CYII=&quot;)"><svg style="width:100%;height:auto;max-width:100%;margin-bottom:-4px" width="1950" height="1955"></svg><noscript><img style="width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0" src="/assets/ideal-img/ordering.84e6ba0.1950.png" srcset="/assets/ideal-img/ordering.84e6ba0.1950.png 1950w" alt="Ordering operations of a document by timestamp" width="1950" height="1955"></noscript></div></div><div class="image-frame-title_UNlE">Ordering operations of a document by timestamp</div></div>
</li>
</ul>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="views">Views<a href="#views" class="hash-link" aria-label="Direct link to Views" title="Direct link to Views">‚Äã</a></h2>
<ul>
<li>Document views represent the immutable state of a document at a particular point in its history of edits<!-- -->
<ul>
<li>Every change of a document results in a new document view</li>
</ul>
</li>
<li>A document view is identified by its set of graph tips: the document view id<!-- -->
<ul>
<li>Each graph tip is represented as an operation id</li>
</ul>
</li>
<li>It&#x27;s possible to replicate the exact state of a document from the document view id, as long as the history was preserved</li>
<li>Document views are required for <code>previous</code> links, extensions, like capabilities or encryption</li>
</ul>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="forks">Forks<a href="#forks" class="hash-link" aria-label="Direct link to Forks" title="Direct link to Forks">‚Äã</a></h2>
<ul>
<li>If a peer observes duplicate <code>backlink</code> and / or <code>seq_num</code> fields, the <code>timestamp</code> is picked as a tie-breaker, if the <code>timestamp</code> is the same, the hash of the operation (operation ID) is picked as a tie-breaker, with the higher hash winning</li>
<li>Accidental forks are not considered harmful to the system and can usually be resolved easily</li>
<li>Forks by malicious authors need to be actively managed and removed by the application using the capabilities system (see more under &quot;Capabilities&quot;), authors are always explicitly granted permission to contribute to a document, they can be removed after malicious behaviour was noticed</li>
</ul>
<div class="image-frame_fg61"><div class="image-frame-inner_Xabn"><div style="background-size:cover;background-repeat:no-repeat;position:relative;background-image:url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAECAYAAAC3OK7NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAjklEQVR4nGNgYGBgsK/fzwKiNdpuxht2XP1p2n7xq1b7zaMMq/4zg8QR4P9/RhBl3HxZ2abjVKJT17F0w7YLHvX19Uwo6jRar+kYdFxdY9F+Zq1B57UW7e47EWadF5ebdVzcpN1+vRSuULP5qp1xx+W3Fu3nvui3Xz2j1Xajy6zz4k+z9vNfdNquLQUpAgC4dDo6ceVJeAAAAABJRU5ErkJggg==&quot;)"><svg style="width:100%;height:auto;max-width:100%;margin-bottom:-4px" width="1710" height="677"></svg><noscript><img style="width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0" src="/assets/ideal-img/fork.f2654cb.1710.png" srcset="/assets/ideal-img/fork.f2654cb.1710.png 1710w" alt="Example of a tolerated fork. We prefer the operation with the higher timestamp" width="1710" height="677"></noscript></div></div><div class="image-frame-title_UNlE">Example of a tolerated fork. We prefer the operation with the higher timestamp</div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="history">History<a href="#history" class="hash-link" aria-label="Direct link to History" title="Direct link to History">‚Äã</a></h2>
<ul>
<li>The latest operations (see <a href="#ordering">&quot;Ordering&quot;</a>) of the set determine the latest state of the document</li>
<li>Documents can contain the history of their changes by preserving older operations</li>
<li>It is possible to retain all history, or just the latest <code>n</code> operations for a document<!-- -->
<ul>
<li><strong>Shallow documents</strong>: only keep the latest <code>n</code> operations<!-- -->
<ul>
<li>As new operations arrive from each author, they replace older versions, these older operations can be garbage collected</li>
<li>In this case causal ordering (<code>previous</code> links) between operations is sometimes lost and operation ordering falls-back to using <code>timestamp</code></li>
</ul>
</li>
<li><strong>Deep documents</strong>: keep all causal history back to the document&#x27;s CREATE operation<!-- -->
<ul>
<li>This guarantees accurate, delay-tolerant ordering of operations</li>
<li>Garbage collection can still be performed on the body of operations</li>
<li>Headers are retained for the lifetime of the document</li>
</ul>
</li>
</ul>
</li>
<li>Depending on the applications requirements documents with a &quot;longer&quot; history can securely guarantee ordering through the <code>previous</code> links while more shallow documents need to rely more on insecure / forgeable timestamps</li>
<li>Example: Using a CRDT into the operation body (like <a href="https://docs.yjs.dev/" target="_blank" rel="noopener noreferrer">YJS</a> documents, for collaborative text editing for example), you might be interested <em>only</em> in the last operations per author and merge them to receive the latest document state:</li>
</ul>
<div class="image-frame_fg61"><div class="image-frame-inner_Xabn"><div style="background-size:cover;background-repeat:no-repeat;position:relative;background-image:url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAJCAYAAAALpr0TAAAACXBIWXMAAAsTAAALEwEAmpwYAAABW0lEQVR4nGPYdOjyyr3n7r49dufdmfu3b3c9uXD4/ctrp/5/f3ipg4GBgeH////MIJohJjHffN2By5o3/v8XaWvq8Tuzd0vpyysnc389vmAOVcjIAANTpqziAdEf7531e3rp6LvHFw7//Pn4YhNI7MyZNNb//xmYwArr66eAFVZWdrgeP3Ag7+ndayn/3z81QjFRpfFagXHL2Z1yjXcW9pYXxrwolp9yvUh78Ytyyah3B6T6bq+W2fp+t/R0hoBZd2dEzLzy3WPmgxsrZk5sejU9+un9qYm/3s2N6n17zHX/3e1u398dcz8DMnrC718/3/7/8+vC////a379+X/5x++/z/7+/9/y68//HT9//X/z5///Qwz//v3je/bsmfzZq1flL1++LXvz5l3bG3fuON++fVvl4sWLMs+fP1f4//+/CNidsLD6//+/28dPn558/PT547dv36qRwxEAsZLUU1zKM4MAAAAASUVORK5CYII=&quot;)"><svg style="width:100%;height:auto;max-width:100%;margin-bottom:-4px" width="1930" height="1788"></svg><noscript><img style="width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0" src="/assets/ideal-img/yjs-example.6c62c90.1930.png" srcset="/assets/ideal-img/yjs-example.6c62c90.1930.png 1930w" alt="Document with maximum depth(1), useful for working with CRDTs like y-js" width="1930" height="1788"></noscript></div></div><div class="image-frame-title_UNlE">Document with maximum depth(1), useful for working with CRDTs like y-js</div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="deletion">Deletion<a href="#deletion" class="hash-link" aria-label="Direct link to Deletion" title="Direct link to Deletion">‚Äã</a></h2>
<p>namakemono offers different forms of automatic or user-indented deletion, with various degrees of privacy as sometimes you do not want to keep traces of what data has been deleted by whom.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="garbage-collection">Garbage Collection<a href="#garbage-collection" class="hash-link" aria-label="Direct link to Garbage Collection" title="Direct link to Garbage Collection">‚Äã</a></h3>
<ul>
<li>Garbage collection only takes place locally, other peers do not need to be informed about this decision</li>
</ul>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="operations-1">Operations<a href="#operations-1" class="hash-link" aria-label="Direct link to Operations" title="Direct link to Operations">‚Äã</a></h4>
<ul>
<li>As already mentioned under <a href="#history">&quot;History&quot;</a> we can limit the maximum amount of operations per document and per author</li>
<li>&quot;Useless&quot; operations are removed instantly as soon as the new one arrives</li>
</ul>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="documents-1">Documents<a href="#documents-1" class="hash-link" aria-label="Direct link to Documents" title="Direct link to Documents">‚Äã</a></h4>
<ul>
<li>Some documents are only retained when they are referenced by other documents, or if a reference they contain is still alive</li>
<li>When references expire, documents or entire collections can be automatically garbage collected
without leaving a trace</li>
<li>See <a href="#collections">&quot;Collections&quot;</a> for an example</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="tombstones">Tombstones<a href="#tombstones" class="hash-link" aria-label="Direct link to Tombstones" title="Direct link to Tombstones">‚Äã</a></h3>
<ul>
<li>To delete a single document we can publish a <strong>Tombstone</strong> operation which will cause all operations for this document to be deleted</li>
<li>This tombstone is sent other peers to inform them that we want this document to be deleted. To
ensure the document remains deleted network wide, the tombstone should be kept until the
document is &quot;dropped&quot; via garbage collection</li>
<li>If we want to delete / tombstone the document we add the action field inside the header, no body is required<!-- -->
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d3d0c8;--prism-background-color:#2d2d2d"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#d3d0c8;background-color:#2d2d2d"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d3d0c8"><span class="token keyword" style="color:#ffcc66">struct</span><span class="token plain"> </span><span class="token type-definition class-name" style="color:#9ddab3">Header</span><span class="token plain"> </span><span class="token punctuation" style="color:#f2f0ec">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">    </span><span class="token comment" style="color:#66cccc">/// Needs to be set to &quot;true&quot; to tombstone this document</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">    tombstone</span><span class="token punctuation" style="color:#f2f0ec">:</span><span class="token plain"> </span><span class="token class-name" style="color:#9ddab3">Option</span><span class="token operator" style="color:#f2f0ec">&lt;</span><span class="token keyword" style="color:#ffcc66">bool</span><span class="token operator" style="color:#f2f0ec">&gt;</span><span class="token punctuation" style="color:#f2f0ec">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">    </span><span class="token comment" style="color:#66cccc">// .. plus all other header fields</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain"></span><span class="token punctuation" style="color:#f2f0ec">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>As soon as we&#x27;ve observed at least one tombstone operation inside a document we do not accept any other further operations</li>
<li>If references expire as a result of document deletion then then any effected documents should also be deleted (see <a href="#garbage-collection">&quot;Garbage Collection&quot;</a>)</li>
</ul>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="extensions">Extensions<a href="#extensions" class="hash-link" aria-label="Direct link to Extensions" title="Direct link to Extensions">‚Äã</a></h2>
<p>Operations can be extended with certain features we usually want for high-level application concerns, like permission, encryption or defining data hierarchies. For this the header can be extended with additional informations.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ephemeral-documents">Ephemeral documents<a href="#ephemeral-documents" class="hash-link" aria-label="Direct link to Ephemeral documents" title="Direct link to Ephemeral documents">‚Äã</a></h3>
<ul>
<li>Documents can be defined as &quot;ephemeral&quot;, giving an expiry date after which all their operations should be deleted</li>
<li>No tombstones are needed for this sort of deletion</li>
<li>The following field is added to the header:<!-- -->
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d3d0c8;--prism-background-color:#2d2d2d"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#d3d0c8;background-color:#2d2d2d"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d3d0c8"><span class="token keyword" style="color:#ffcc66">struct</span><span class="token plain"> </span><span class="token type-definition class-name" style="color:#9ddab3">Header</span><span class="token plain"> </span><span class="token punctuation" style="color:#f2f0ec">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">    </span><span class="token comment" style="color:#66cccc">/// UNIX timestamp</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">    delete_after</span><span class="token punctuation" style="color:#f2f0ec">:</span><span class="token plain"> </span><span class="token class-name" style="color:#9ddab3">Option</span><span class="token operator" style="color:#f2f0ec">&lt;</span><span class="token keyword" style="color:#ffcc66">u64</span><span class="token operator" style="color:#f2f0ec">&gt;</span><span class="token punctuation" style="color:#f2f0ec">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">    </span><span class="token comment" style="color:#66cccc">// .. plus all other header fields</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain"></span><span class="token punctuation" style="color:#f2f0ec">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="schemas">Schemas<a href="#schemas" class="hash-link" aria-label="Direct link to Schemas" title="Direct link to Schemas">‚Äã</a></h3>
<ul>
<li>Schemas are documents which can be used to verify that an operation or document following that schema is respecting a certain format</li>
<li>Other documents can refer to that schema to indicate that they comply with this format</li>
<li>We can do this by adding an extension field in the operation header:<!-- -->
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d3d0c8;--prism-background-color:#2d2d2d"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#d3d0c8;background-color:#2d2d2d"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d3d0c8"><span class="token keyword" style="color:#ffcc66">struct</span><span class="token plain"> </span><span class="token type-definition class-name" style="color:#9ddab3">Header</span><span class="token plain"> </span><span class="token punctuation" style="color:#f2f0ec">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">    </span><span class="token comment" style="color:#66cccc">/// Document View ID of the schema document</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">    schema_id</span><span class="token punctuation" style="color:#f2f0ec">:</span><span class="token plain"> </span><span class="token class-name" style="color:#9ddab3">Option</span><span class="token operator" style="color:#f2f0ec">&lt;</span><span class="token class-name" style="color:#9ddab3">Hash</span><span class="token punctuation" style="color:#f2f0ec">[</span><span class="token punctuation" style="color:#f2f0ec">]</span><span class="token operator" style="color:#f2f0ec">&gt;</span><span class="token punctuation" style="color:#f2f0ec">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">    </span><span class="token comment" style="color:#66cccc">// .. plus all other header fields</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain"></span><span class="token punctuation" style="color:#f2f0ec">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>Document view ids are lists of all operation ids we want to refer to to &quot;reconstruct&quot; exactly this version of the document. This is required for deterministic behaviour and supporting schema &quot;migrations&quot;</li>
<li>We distinguish between &quot;system schemas&quot; and &quot;application schemas&quot;</li>
<li>System schemas are determined by this very specification and usually serve low-level purposes like handling permissions etc. while application schemas are defined by application developers</li>
<li>Application schemas are not further defined and can follow different sorts of schema / validation techniques, depending on the application data</li>
<li>Nodes can identify schemas of documents and validate them accordingly, reject operations which do not follow the given schema correctly</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="collections">Collections<a href="#collections" class="hash-link" aria-label="Direct link to Collections" title="Direct link to Collections">‚Äã</a></h3>
<ul>
<li>Sometimes we want to express multiple documents to be part of the same collection</li>
<li>We can do this by publishing a <strong>Collection</strong> document and then adding an extension field in the operation of each document to assign it to this collection</li>
<li>To create a collection document we publish a CREATE operation with the following <code>schema_id</code> header<!-- -->
<ul>
<li><code>schema_id</code>: <code>collections_v1</code>
<ul>
<li>System schema identifier for collection documents</li>
</ul>
</li>
</ul>
</li>
<li>To refer to this collection document we refer to it using the document id in the header<!-- -->
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d3d0c8;--prism-background-color:#2d2d2d"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#d3d0c8;background-color:#2d2d2d"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#d3d0c8"><span class="token keyword" style="color:#ffcc66">struct</span><span class="token plain"> </span><span class="token type-definition class-name" style="color:#9ddab3">Header</span><span class="token plain"> </span><span class="token punctuation" style="color:#f2f0ec">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">    </span><span class="token comment" style="color:#66cccc">/// Document View ID of the collection document</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">    collection</span><span class="token punctuation" style="color:#f2f0ec">:</span><span class="token plain"> </span><span class="token class-name" style="color:#9ddab3">Option</span><span class="token operator" style="color:#f2f0ec">&lt;</span><span class="token class-name" style="color:#9ddab3">Hash</span><span class="token operator" style="color:#f2f0ec">&gt;</span><span class="token punctuation" style="color:#f2f0ec">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain">    </span><span class="token comment" style="color:#66cccc">// .. plus all other header fields</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d3d0c8"><span class="token plain"></span><span class="token punctuation" style="color:#f2f0ec">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>If a tombstone operation for a collection document was published, <em>all</em> related documents get deleted as well</li>
<li>Collection documents can again refer to &quot;parent&quot; collection documents<!-- -->
<ul>
<li>This allows for neat application patterns to design document and collection hierarchies</li>
</ul>
</li>
<li>Together with capabilities and collections we can express complex hierarchies of permissions. We can grant CREATE capabilities to allow publishing new documents in a collection, or think of groupings to express admins, roles and moderators etc.<!-- -->
<div class="image-frame_fg61"><div class="image-frame-inner_Xabn"><div style="background-size:cover;background-repeat:no-repeat;position:relative;background-image:url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAECAYAAAC3OK7NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAjUlEQVR4nCXJ0QqCMBiG4d3/5YThmgkeDIwSt7WuoUBzY2soKPu/yA6ek/dlGagz8ACgicjMy7LLRAbAHf93ZgAEgF/st23bgUgB6JDzaZ4Xva6rYC4k4UMyk4/ta5z6YfJXF9PNhU/nYzo8h7ceXRSslKoupbJVawsutala23CpmqLpTHUxRy6V5dLUXzOljYDh2nieAAAAAElFTkSuQmCC&quot;)"><svg style="width:100%;height:auto;max-width:100%;margin-bottom:-4px" width="1640" height="704"></svg><noscript><img style="width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0" src="/assets/ideal-img/collections.8f856dd.1640.png" srcset="/assets/ideal-img/collections.8f856dd.1640.png 1640w" alt="Collections help to structure application data, moderation roles, permissions and hierarchies" width="1640" height="704"></noscript></div></div><div class="image-frame-title_UNlE">Collections help to structure application data, moderation roles, permissions and hierarchies</div></div>
</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="capabilities">Capabilities<a href="#capabilities" class="hash-link" aria-label="Direct link to Capabilities" title="Direct link to Capabilities">‚Äã</a></h3>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><span class="panda-icon">üêß</span></span>note</div><div class="admonitionContent_BuS1"><p>Capabilities are in the workings for 2024. Watch this space!</p></div></div>
<ul>
<li>Capabilites are documents which grant permissions to certain public keys<!-- -->
<ul>
<li>It&#x27;s like a token given to somebody else and they can use this token to proof now that they are allowed to do something</li>
</ul>
</li>
<li>These tokens can be revoked at any time<!-- -->
<ul>
<li>If verifiable causal history during revocation is required, a high document depth and
including <code>previous</code> is recommended</li>
</ul>
</li>
<li>To create a capability document we publish a CREATE operation with the following <code>schema_id</code> header<!-- -->
<ul>
<li><code>schema_id</code>: <code>caps_v1</code>
<ul>
<li>System schema identifier for capabilities documents</li>
</ul>
</li>
</ul>
</li>
<li>Capabilities can be given to UPDATE or DELETE documents</li>
<li>When using Collections they can also be given to CREATE documents within that Collection</li>
<li>Capabilities are given by stating:<!-- -->
<ul>
<li><code>type</code>
<ul>
<li>Can be either <code>1</code> add permission or <code>0</code>: revoke permission</li>
</ul>
</li>
<li><code>document_id</code>
<ul>
<li>Which document does this capability apply to</li>
</ul>
</li>
<li><code>public_key</code>
<ul>
<li>Whom do I give this permission</li>
</ul>
</li>
<li><code>seq_num</code> (for <code>update</code> and <code>tombstone</code> actions)<!-- -->
<ul>
<li>From which point in an authors contribution history do I give permission to this author?<!-- -->
<ul>
<li>If not known, <code>0</code> is chosen</li>
</ul>
</li>
<li>When revoking: From which point on do I remove this permission?</li>
<li>If revoking permission after a malicious fork it is recommended to revoke from <code>seq_num</code> @ fork - 1</li>
<li>To completly remove a malicious actor it is possible to revoke all previously given capabilities by removing them from <code>seq_num</code> 0 on</li>
</ul>
</li>
<li><code>action</code>
<ul>
<li><code>read</code></li>
<li><code>create</code></li>
<li><code>update</code></li>
<li><code>tombstone</code></li>
<li><code>sync</code>
<ul>
<li>We want to support federation, for these cases we&#x27;re explicitly separating &quot;reading&quot; from &quot;syncing&quot;</li>
</ul>
</li>
</ul>
</li>
<li><code>create_allowance</code> (for <code>create</code> action)<!-- -->
<ul>
<li>When handing out <code>create</code> action capabilities an allowance can be specified as an unsigned integer, this limits the number of documents which can be created by this author in the target collection. Documents are selected in timestamp order, newest first.</li>
</ul>
</li>
</ul>
</li>
<li>Other authors need to now refer to the most recent known document view id for when they publish an operation. They do this by stating the document View Id in the extension of their Operation<!-- -->
<ul>
<li><code>capability</code>: <code>Hash[]</code>
<ul>
<li>List of operation ids representing the latest known version of this capability document</li>
<li>With this, honest peers limit the damage a malicious node can do, as they lock in any changes to the cap doc as they update the target doc. The worst a malicious node can do is withold state from both the cap and target document. Without the pointer they could withold operations from just the cap group &quot;allowing in&quot; operations to the target doc which already had their permissions revoked.</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="image-frame_fg61"><div class="image-frame-inner_Xabn"><div style="background-size:cover;background-repeat:no-repeat;position:relative;background-image:url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAFCAYAAAB8ZH1oAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAoklEQVR4nGOwaDu+ZdGyzMP/z/GIMjAwMNTXMzCBaAwQM2WjyvOd6steb1dXB/GN7X1EAqPTJONLSiQ0TJ2FVVQ82FE01NfP59DSCmVjkI/nsLe351hVH8pmb2/PwsAAt+E/4///DIwg1t2N2u1/DohuyJsxo1Gz+eYxs+4rWhBT/qM659EeVeldk5VM0ur7jFTzt5ir+2VL6enpcRsbG7MCAOB8MIXcnmDiAAAAAElFTkSuQmCC&quot;)"><svg style="width:100%;height:auto;max-width:100%;margin-bottom:-4px" width="2322" height="1221"></svg><noscript><img style="width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0" src="/assets/ideal-img/cap-1.bef5553.2322.png" srcset="/assets/ideal-img/cap-1.bef5553.2322.png 2322w" alt="Blue granting &#x27;write&#x27; permission to the Yellow author" width="2322" height="1221"></noscript></div></div><div class="image-frame-title_UNlE">Blue granting &#x27;write&#x27; permission to the Yellow author</div></div>
<div class="image-frame_fg61"><div class="image-frame-inner_Xabn"><div style="background-size:cover;background-repeat:no-repeat;position:relative;background-image:url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAFCAYAAAB8ZH1oAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAoElEQVR4nGMw6bhwcOHy7Bc/D4vqMzAwMPyvZ2AC0RggoP+A5qutOgv+7xExwqvQsP3yLum5ex5wr16mHcrAwKyn58otI2PBySAfz8EgE8rJoKXFBlYoXryTW2HtzF7d5bNs7e1DecTLyxWMC6IlJ9abycyqN5OxT65X8apeI49iuuqqOX2SaxZedtnQNv/tNvlDb/eq7rfuOr1Ru+3mHgA1eDahSIEJ9wAAAABJRU5ErkJggg==&quot;)"><svg style="width:100%;height:auto;max-width:100%;margin-bottom:-4px" width="2186" height="1108"></svg><noscript><img style="width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0" src="/assets/ideal-img/cap-2.4b573f7.2186.png" srcset="/assets/ideal-img/cap-2.4b573f7.2186.png 2186w" alt="Blue granting &#x27;write&#x27; permission to the Green author" width="2186" height="1108"></noscript></div></div><div class="image-frame-title_UNlE">Blue granting &#x27;write&#x27; permission to the Green author</div></div>
<div class="image-frame_fg61"><div class="image-frame-inner_Xabn"><div style="background-size:cover;background-repeat:no-repeat;position:relative;background-image:url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAGCAYAAAD68A/GAAAACXBIWXMAAAsTAAALEwEAmpwYAAAApklEQVR4nGMw6rhyoXtRw9uvB2RMGRgYGP7/r2cC0RjAsPms/Jutmhv/7xbxAStcxcCMXWH71R3KM/dcFls/TxcsUI/DRKumU+oiy1bt41+zIhgssGoVdhON26+s71zQfOzzRkFtBoaZrGYeZnxa9vY8Wlr2PCDaPjSUR0srlI1Buem29qPtOkff7VCMBmksDLXgNDY2ZgVJamlpsYWG1rMxMNQzAQBTwDXUd+v33QAAAABJRU5ErkJggg==&quot;)"><svg style="width:100%;height:auto;max-width:100%;margin-bottom:-4px" width="2092" height="1252"></svg><noscript><img style="width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0" src="/assets/ideal-img/cap-3.304701e.2092.png" srcset="/assets/ideal-img/cap-3.304701e.2092.png 2092w" alt="Blue removing &#x27;write&#x27; permission of the Yellow author for the future" width="2092" height="1252"></noscript></div></div><div class="image-frame-title_UNlE">Blue removing &#x27;write&#x27; permission of the Yellow author for the future</div></div>
<div class="image-frame_fg61"><div class="image-frame-inner_Xabn"><div style="background-size:cover;background-repeat:no-repeat;position:relative;background-image:url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAHCAYAAAAxrNxjAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA5UlEQVR4nGOw7Tq1cu/6kLv/T3HIMjAwMPz/z8DIgA04dRwK2b/WZ87/QwyieBUadZ/v5Vu0/RzDplVyYIH//7ErNGk/k2+5YPks45lFIgwMDIxaoVpsxsbGrDCspRXKVs9Qz8Tg0nOw4t4W06v/97OrMDDkslu6uoppWbgJyVi4CWm5uQkpGbvwM2hpsTHYdJ2unrMsb9r/Iwy8DAz/mbRCQ9lcY2K4Q5MLhRgY/jO+zMriuRkXKs3g1HMw++pmyxtvDqloia9YNkFuw4xt6lP3LTNovbHj3M3ji77d3nX+7fTWMACRMVO5LInX7AAAAABJRU5ErkJggg==&quot;)"><svg style="width:100%;height:auto;max-width:100%;margin-bottom:-4px" width="2334" height="1680"></svg><noscript><img style="width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0" src="/assets/ideal-img/cap-4.7f92df2.2334.png" srcset="/assets/ideal-img/cap-4.7f92df2.2334.png 2334w" alt="Blue retroactively removing operations of malicious Yellow author" width="2334" height="1680"></noscript></div></div><div class="image-frame-title_UNlE">Blue retroactively removing operations of malicious Yellow author</div></div>
<ul>
<li>Capability documents can again refer to &quot;parent&quot; capability documents<!-- -->
<ul>
<li>This allows for neat application patterns like granting admin access / access to changing access for other users in an application</li>
</ul>
</li>
</ul>
<div class="image-frame_fg61"><div class="image-frame-inner_Xabn"><div style="background-size:cover;background-repeat:no-repeat;position:relative;background-image:url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAICAYAAADA+m62AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAnklEQVR4nGNgQADmnp4eK//eA7rG5YflkMQxgUtaB79Zz/Xlhp1XmyAi/xnR1YAFjGf+Z7XqvznBuPtmHrI4EoDo1Kq/wmbff22pee/VBlwmgkHazJmsYj1vUwTaX/videP/VQzMvzqsa/83G8fjVfh8u77CvUnONXcn2WX9P6MmgmoK1MH/ZxqzvtqlvvDjYeWO1wdU573fq9KCLA8A57M6pBELTXoAAAAASUVORK5CYII=&quot;)"><svg style="width:100%;height:auto;max-width:100%;margin-bottom:-4px" width="1734" height="1359"></svg><noscript><img style="width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0" src="/assets/ideal-img/caps-nesting.f02262e.1734.png" srcset="/assets/ideal-img/caps-nesting.f02262e.1734.png 1734w" alt="Nesting capabilities to express complex user hierarchies and roles" width="1734" height="1359"></noscript></div></div><div class="image-frame-title_UNlE">Nesting capabilities to express complex user hierarchies and roles</div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="encryption">Encryption<a href="#encryption" class="hash-link" aria-label="Direct link to Encryption" title="Direct link to Encryption">‚Äã</a></h3>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><span class="panda-icon">üêß</span></span>note</div><div class="admonitionContent_BuS1"><p>Encryption is mostly handled by MLS and our &quot;Secret Group&quot; specification which is heavily in the workings in our roadmap 2024. Go to <a href="https://arewemlsyet.com/" target="_blank" rel="noopener noreferrer">https://arewemlsyet.com/</a> for more information around decentralised MLS.</p></div></div>
<ul>
<li>Operations refer to the MLS group and Epoch they used by using the document View Id of the MLS Group<!-- -->
<ul>
<li><code>secret</code>: <code>Hash[]</code></li>
</ul>
</li>
<li>Both header and body can be fully encrypted if no federation is required for the application</li>
<li>If federation should be supported header data needs to stay plain-text and only the body can be encrypted<!-- -->
<ul>
<li>Exceptions are possible but this greatly depends on where trust is established in the application</li>
<li>This is a trade-off which needs to be decided by the application (no meta data leakage vs. federation support)<!-- -->
<ul>
<li>Federation is essentially &quot;shared computing&quot; where nodes do the &quot;heavy work&quot; for lightweight clients</li>
</ul>
</li>
</ul>
</li>
<li>System documents (capabilities, secret groups / MLS etc.) can never be encrypted<!-- -->
<ul>
<li>Except when sharing encryption secrets is dealt with through another channels but this is out of scope for this specification</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="replication">Replication<a href="#replication" class="hash-link" aria-label="Direct link to Replication" title="Direct link to Replication">‚Äã</a></h2>
<ul>
<li>Nodes essentially ask for what documents (for example scoped by schema id, timestamp range,
collection ids, document ids etc.) they are interested in. As documents drop out of this scope
they can be garbage collected. Through configuring this scope they have control over the data
they persist locally and replicate on the network.</li>
<li>Replication in itself is taking place by exchanging &quot;log heights&quot; since all documents can be expressed as logs, even when including forks (the forked branch is considered its own &quot;log&quot;)</li>
<li>Log heights are tuples of <code>(document id, public key, latest known seq num)</code></li>
<li>The latest known operation id needs to be added as well if it is known that a fork exists</li>
<li>Nodes can not retrieve any data from any author or document if no <code>sync</code> capability was given</li>
</ul>
<div class="image-frame_fg61"><div class="image-frame-inner_Xabn"><div style="background-size:cover;background-repeat:no-repeat;position:relative;background-image:url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAHCAYAAAAxrNxjAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAxUlEQVR4nE2NPQrCQBSEV5QEGw9gp42FIgop1CoeQPQE4i0sBY+zB8gprCxioYIhpdW6f9ksZGRjEnzwHsObjxlSFIUfx/flM02n5Dctd5Lk3b/eHgHnPGRCHAhjbMSFeEmpLijQq2CitR5Ya8OPlFsh1JEAKBPyPA+01us/cJhl2cbpkqlBA0yUUqvaANAB0AXQBuA1IOdmzJhcVKAzy38zTaIxc15VR1HkU0o9p12LlHLXgABmXOvQ6ROlntsqYG+tPX8BtB+P0F7hlKkAAAAASUVORK5CYII=&quot;)"><svg style="width:100%;height:auto;max-width:100%;margin-bottom:-4px" width="2358" height="1768"></svg><noscript><img style="width:100%;height:auto;max-width:100%;margin-bottom:-4px;position:absolute;top:0;left:0" src="/assets/ideal-img/replication.71979d9.2358.png" srcset="/assets/ideal-img/replication.71979d9.2358.png 2358w" alt="Two nodes replicating data with each other" width="2358" height="1768"></noscript></div></div><div class="image-frame-title_UNlE">Two nodes replicating data with each other</div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/specifications/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Specifications</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/specifications/aquadoggo/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">aquadoggo API</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#short-overview" class="table-of-contents__link toc-highlight">Short overview</a></li><li><a href="#encoding--cryptographic-primitives" class="table-of-contents__link toc-highlight">Encoding &amp; Cryptographic Primitives</a></li><li><a href="#documents" class="table-of-contents__link toc-highlight">Documents</a></li><li><a href="#operations" class="table-of-contents__link toc-highlight">Operations</a></li><li><a href="#creating-documents" class="table-of-contents__link toc-highlight">Creating documents</a></li><li><a href="#updating-documents" class="table-of-contents__link toc-highlight">Updating documents</a></li><li><a href="#collaboration" class="table-of-contents__link toc-highlight">Collaboration</a></li><li><a href="#ordering" class="table-of-contents__link toc-highlight">Ordering</a></li><li><a href="#views" class="table-of-contents__link toc-highlight">Views</a></li><li><a href="#forks" class="table-of-contents__link toc-highlight">Forks</a></li><li><a href="#history" class="table-of-contents__link toc-highlight">History</a></li><li><a href="#deletion" class="table-of-contents__link toc-highlight">Deletion</a><ul><li><a href="#garbage-collection" class="table-of-contents__link toc-highlight">Garbage Collection</a></li><li><a href="#tombstones" class="table-of-contents__link toc-highlight">Tombstones</a></li></ul></li><li><a href="#extensions" class="table-of-contents__link toc-highlight">Extensions</a><ul><li><a href="#ephemeral-documents" class="table-of-contents__link toc-highlight">Ephemeral documents</a></li><li><a href="#schemas" class="table-of-contents__link toc-highlight">Schemas</a></li><li><a href="#collections" class="table-of-contents__link toc-highlight">Collections</a></li><li><a href="#capabilities" class="table-of-contents__link toc-highlight">Capabilities</a></li><li><a href="#encryption" class="table-of-contents__link toc-highlight">Encryption</a></li></ul></li><li><a href="#replication" class="table-of-contents__link toc-highlight">Replication</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer_J6tW"><img class="footer-img__0Xc" src="/images/deepsea-panda.svg" width="100"><div><img class="supporters-img_P2oV" src="/images/nlnet-logo.svg" width="140"><img class="supporters-img_P2oV" src="/images/ngi-logo.png" width="200"><img class="supporters-img_P2oV" src="/images/eu-flag-logo.png" width="78"><p class="footer-text_MXRq">This project has received funding from the European Union‚Äôs Horizon 2020 research and innovation programme within the framework of the NGI-POINTER Project funded under grant agreement No 871528, NGI-ASSURE No 957073 and NGI0-ENTRUST No 101069594</p></div><p class="footer-text_MXRq">CC BY-SA 4.0<!-- --> - <a href="/contact">Contact</a> -<!-- --> <a href="https://autonomous.zone/@p2panda" target="_blank" rel="noreferrer">Fediverse</a></p></footer></div>
</body>
</html>