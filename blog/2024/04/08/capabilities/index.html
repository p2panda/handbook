<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.0">
<title data-rh="true">capabilities | p2panda</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://p2panda.org/blog/2024/04/08/capabilities"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="capabilities | p2panda"><meta data-rh="true" name="description" content="---"><meta data-rh="true" property="og:description" content="---"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2024-04-08T00:00:00.000Z"><link data-rh="true" rel="icon" href="/images/deepsea-panda.svg"><link data-rh="true" rel="canonical" href="https://p2panda.org/blog/2024/04/08/capabilities"><link data-rh="true" rel="alternate" href="https://p2panda.org/blog/2024/04/08/capabilities" hreflang="en"><link data-rh="true" rel="alternate" href="https://p2panda.org/blog/2024/04/08/capabilities" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="p2panda News RSS Feed"><link rel="stylesheet" href="/assets/css/styles.862b1275.css">
<script src="/assets/js/runtime~main.b1aab97d.js" defer="defer"></script>
<script src="/assets/js/main.cec126d6.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><div class="navbar__brand"><div class="navbar__logo"><img src="/images/p2panda-book.png" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/images/p2panda-book.png" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></div></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/images/p2panda-book.png" alt="p2panda Handbook" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/images/p2panda-book.png" alt="p2panda Handbook" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a class="navbar__item navbar__link" href="/about/">About</a><a class="navbar__item navbar__link" href="/tutorials/">Tutorials</a><a class="navbar__item navbar__link" href="/sdks/">SDKs</a><a class="navbar__item navbar__link" href="/specifications/">Specifications</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/faq">FAQ</a><a class="navbar__item navbar__link" href="/links">Links</a><a class="navbar__item navbar__link" href="/contact">Contact</a><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/blog/2024/04/08/capabilities">capabilities</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2024/01/17/roadmap-24">Plans 2024</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/11/17/aquadoggo">aquadoggo 0.7.0</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="https://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="---"><header><h1 class="title_f1Hy" itemprop="headline">capabilities</h1><div class="container_mt6G margin-vert--md"><time datetime="2024-04-08T00:00:00.000Z" itemprop="datePublished">April 8, 2024</time></div></header><div id="__blog-post-container" class="markdown" itemprop="articleBody"><hr>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="title-capabilities-in-a-p2p-world">title: Capabilities in a p2p world<a href="#title-capabilities-in-a-p2p-world" class="hash-link" aria-label="Direct link to title: Capabilities in a p2p world" title="Direct link to title: Capabilities in a p2p world">​</a></h2>
<p><em>TLDR; capability based access control system designs for p2panda: <a href="https://github.com/p2panda/capabilities/blob/main/DESIGN.md" target="_blank" rel="noopener noreferrer">https://github.com/p2panda/capabilities/blob/main/DESIGN.md</a></em></p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="introduction">Introduction<a href="#introduction" class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction">​</a></h2>
<p>Hello 👋 and welcome to the first p2panda research blog post! This is the start of series of posts where we&#x27;ll be publicly documenting our research process. We&#x27;ve always cared about making our system designs accessible and publishing tutorials and other learning resources. This is an effort to also make our research more transparent and hopefully useful to users and developers in the wider p2p ecosystem.</p>
<p>One of our primary tasks over the next months is to design and implement an access control system for p2panda. This is no simple matter in a leaderless peer-to-peer network. When using centralized services, we put our trust in a single provider, and delegate to them responsibility for storing data and authorizing access requests. This will likely involve agreeing user credentials (username, password etc..). By knowing these credentials it is assumed we have authority to access to my data.</p>
<p>This model is not possible (or welcome!) in peer-to-peer systems. There is no central source of authority, so we need a way for peers to communicate authority boundaries themselves, in a away which allows all peers on the network to act as &quot;authorizer&quot; when handling access requests. There are many well researched approaches to designing access control systems in multi-actor systems, originating not only in network technologies, but also operating system design and asynchronous programming environments, which offer solutions to this very problem. Many of these incorporate patterns from Capability-based Security <a href="https://en.wikipedia.org/wiki/Capability-based_security" target="_blank" rel="noopener noreferrer">wikipedia</a> systems. In the rest of this article we&#x27;ll go a little deeper into what a system like this needs to look like for p2panda, look over a few systems we&#x27;ve spent time researching, and then share our current designs.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ownership-in-a-peer-to-peer-world">Ownership in a peer-to-peer world<a href="#ownership-in-a-peer-to-peer-world" class="hash-link" aria-label="Direct link to Ownership in a peer-to-peer world" title="Direct link to Ownership in a peer-to-peer world">​</a></h2>
<p>Peer-to-peer protocols such as p2panda use public-key cryptography and digital signatures to establish the identity of peers and the authenticity of messages replicated on a network. Any peer can verify that messages it receives were created by the claimed peer (public key), and that they have not been tampered with by any third parties. This technically allows peers to replicate messages freely to <em>anyone</em>, safe in the knowledge that the original author of the message can be verified and if tampering occurred it will be detected.</p>
<p>What if we don&#x27;t want to share data with everyone though? Even if we know it won&#x27;t be tampered with, we understandably want a stricter system where an author has control over where their data can travel, and how peers are allowed to interact with it. If we understand &quot;authorship&quot; as equal to &quot;ownership&quot; then we can say that only an owner has &quot;read&quot; and &quot;write&quot; authority over the data they created (&quot;write&quot; authority being relevant to long-lived mutable data). This actually now sounds a little like our centralized service described above, there is again a &quot;single service&quot; which controls your data, this time it&#x27;s <em>you</em> though.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="access-token-basics">Access token basics<a href="#access-token-basics" class="hash-link" aria-label="Direct link to Access token basics" title="Direct link to Access token basics">​</a></h2>
<p>If we all kept our data to ourselves, this wouldn&#x27;t be very interesting though, in healthy collaborative peer-to-peer networks you want to share your data with peers you trust and let them share it further too. Token based capabilities offer us patterns for making this possible. Let&#x27;s say that I&#x27;ve authored some blog posts which I want all my friends to be able to read, I can hand out unforgeable (signed) tokens to each of them, which states that they can &quot;read&quot; any posts I write. Equally, my friends can prove to <em>each other</em> that they have been authorized (by me) to read the posts, and so can share posts between themselves when I&#x27;m not even there. In rather simplified terms, this is how token based capabilities work.</p>
<p>Don&#x27;t take my word for it though, from <a href="https://en.wikipedia.org/wiki/Capability-based_security" target="_blank" rel="noopener noreferrer">wikipedia</a>:</p>
<blockquote>
<p>Capability-based security is a concept in the design of secure computing systems, one of the existing security models. A capability (known in some systems as a key) is a communicable, unforgeable token of authority. It refers to a value that references an object along with an associated set of access rights. A user program on a capability-based operating system must use a capability to access an object. Capability-based security refers to the principle of designing user programs such that they directly share capabilities with each other according to the principle of least privilege, and to the operating system infrastructure necessary to make such transactions efficient and secure. Capability-based security is to be contrasted with an approach that uses traditional UNIX permissions and Access Control Lists.</p>
</blockquote>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="what-do-we-need">What do we need?<a href="#what-do-we-need" class="hash-link" aria-label="Direct link to What do we need?" title="Direct link to What do we need?">​</a></h2>
<p>We came to this research with a set of requirements for any capability system to be used with p2panda:</p>
<ul>
<li>authors have fine-grained control over who can access and perform actions their data</li>
<li>tokens can be distributed freely but only used by the intended recipient</li>
<li>delay tolerant networks and offline-first operation supported</li>
<li>tokens can be delegated and revoked</li>
<li>role based access control patterns can be modeled</li>
<li>hierarchical and &quot;flat&quot; ownership of resources can be modeled</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="supported-ownership-models">Supported ownership models<a href="#supported-ownership-models" class="hash-link" aria-label="Direct link to Supported ownership models" title="Direct link to Supported ownership models">​</a></h3>
<p>A requirement of our system is that it allows developers to build apps which model both &quot;flat&quot; and hierarchical ownership structures with suitable access control boundaries.</p>
<p>The below diagram sketches the access control boundaries for a festival and it&#x27;s schedule of events. The application data has hierarchical ownership structure. There is an admin group which owns the festival and collection of events, organisers are delegated <code>collection/add</code> authority so they can add events to the collection, they own any events they create. Visitors are given <code>document/read</code> authority for the festival info and all it&#x27;s events.</p>
<p><img loading="lazy" src="https://laub.liebechaos.org/uploads/6b5055c1-70bd-4446-808b-fff3caaaa9af.png" alt="" class="img_ev3q"></p>
<p>In the following diagram we can see how non-hierarchical ownership can be modeled with a photo sharing app. The app displays to the user a collection of photos, this isn&#x27;t an &quot;owned&quot; collection as no peer has overall authority over it, each user will have their own photo collection. All they need is read authority for any published photos.</p>
<p><img loading="lazy" src="https://laub.liebechaos.org/uploads/3c5801fc-308e-43d1-8ca7-f229f9118a2e.png" alt="" class="img_ev3q"></p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="the-research">The research<a href="#the-research" class="hash-link" aria-label="Direct link to The research" title="Direct link to The research">​</a></h2>
<p>I&#x27;ve spent a substantial amount of time researching capability systems over the last months, and I still feel like I&#x27;ve only scratched the surface. Here is a selection of projects I&#x27;ve looked into, chosen for their differing approaches and relation to our design goals.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="captp--ocapn-agoric-spritely-capnproto">CapTP / OCapN (Agoric, Spritely, Cap&#x27;N&#x27;Proto)<a href="#captp--ocapn-agoric-spritely-capnproto" class="hash-link" aria-label="Direct link to CapTP / OCapN (Agoric, Spritely, Cap&#x27;N&#x27;Proto)" title="Direct link to CapTP / OCapN (Agoric, Spritely, Cap&#x27;N&#x27;Proto)">​</a></h3>
<p>CapTP (Capability Transport Protocol) is an object-capability protocol which allows &quot;distributed object programming over mutually suspicious networks&quot;. It&#x27;s  origin is in the E programming language which is described as &quot;an object-capability programming language and platform for writing distributed, secure, and robust software&quot;. Sounds good to me so far <!-- -->😄<!-- --> ! There are various implementations out there, notably in Spritely, Agoric and Cap&#x27;N&#x27;Proto. There&#x27;s also a (pre-)standardization effort underway for OCapN (Object Capability Network) network suite which incorporates CapTP.</p>
<p>Despite the system properties feeling intuitively familiar, penetrating the details of the protocol design was actually a challenge. The reasons for this were firstly that important resources are spread across many projects (from the 90s to current day) so it took quite some searching to feel like I was getting a full picture, and secondly many of the implementations are in languages that I&#x27;m not familiar with, so reading through codebases took some extra mental overhead. No fault to be placed anywhere for these factors (decentralization, yay!!), but it was my experience as a new-comer to the ecosystem. Once I got through that though, the very active ecosystems and resources around these projects provided excellent insight into common approaches to capability systems. Certainly looking into the patterns explored by these projects is a great way to understand where the theories around object-capability models originate and how they&#x27;re being implemented today. There&#x27;s a radical spirit and and ambition around much of the work in this particular capability corner which is especially inspiring.</p>
<p>In terms of the features we require, it seems that the CapTP model is aimed at environments where the protocol can run over live connections between peers. Typically a capability will last for the lifetime of a connection, but no longer. I know there are features of the protocol which can be used to extend this lifetime, something which would be needed for our use, but this is at least the starting assumption I believe.</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="links">Links<a href="#links" class="hash-link" aria-label="Direct link to Links" title="Direct link to Links">​</a></h4>
<ul>
<li><a href="https://spritely.institute/" target="_blank" rel="noopener noreferrer">spritely institute</a></li>
<li><a href="https://github.com/capnproto/capnproto/blob/v2/c%2B%2B/src/capnp/rpc.capnp" target="_blank" rel="noopener noreferrer">impressively commented Cap&#x27;N&#x27;Proto RPC document</a> (best resource for CapTP overview)</li>
<li><a href="http://wiki.erights.org/wiki/Main_Page" target="_blank" rel="noopener noreferrer">E programming language</a></li>
<li><a href="https://ocapn.org/" target="_blank" rel="noopener noreferrer">OCapN standardization effort</a></li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ucan">UCAN<a href="#ucan" class="hash-link" aria-label="Direct link to UCAN" title="Direct link to UCAN">​</a></h3>
<p>UCAN (User Controlled Authorization Networks) is described as: &quot;an extension of the popular JSON Web Token format specifically designed to enable ways of authorizing offline-first apps and distributed systems&quot;. Again, we&#x27;re on the right track! Here research was quite straightforward, the design and core data types can be grasped by looking at their website landing page <!-- -->🙏<!-- -->. Their token based approach felt fairly intuitive to pick-up, although not being super familiar with DIDs held me back a little. Their use of JWTs seems to be an explicit attempt to aid in adoption as it&#x27;s a familiar format for web devs already. There&#x27;s an active community around the specifications and implementations, with libraries available in Rust and TypeScript.</p>
<p>It&#x27;s impressive (and I&#x27;m grateful for) how simple and intuitive UCANs are in their design, and the specification is excellent (bonus material if you reach the end of the spec is a useful roll-call of capability systems <a href="https://github.com/ucan-wg/spec?tab=readme-ov-file#10-related-work-and-prior-art" target="_blank" rel="noopener noreferrer">movers and shakers</a>). Of particular interest to us is their first-class support for offline-first applications and delay tolerant networking.</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="links-1">Links<a href="#links-1" class="hash-link" aria-label="Direct link to Links" title="Direct link to Links">​</a></h4>
<ul>
<li><a href="https://ucan.xyz/" target="_blank" rel="noopener noreferrer">UCAN homepage</a></li>
<li><a href="https://github.com/ucan-wg/spec?tab=readme-ov-file" target="_blank" rel="noopener noreferrer">UCAN specification</a></li>
<li><a href="https://github.com/ucan-wg" target="_blank" rel="noopener noreferrer">UCAN working group</a></li>
<li><a href="https://github.com/ucan-wg/rs-ucan" target="_blank" rel="noopener noreferrer">Rust</a> &amp; <a href="https://github.com/ucan-wg/ts-ucan" target="_blank" rel="noopener noreferrer">TypeScript</a> implementations</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="biscuit">Biscuit<a href="#biscuit" class="hash-link" aria-label="Direct link to Biscuit" title="Direct link to Biscuit">​</a></h3>
<blockquote>
<p>Biscuit is a bearer token that supports offline attenuation, can be verified by any system that knows the root public key, and provides a flexible authorization language based on logic programming. It is serialized as Protocol Buffers, and designed to be small enough for storage in HTTP cookies.</p>
</blockquote>
<p>I&#x27;ve included Biscuit in particular for it&#x27;s interesting use of a Datalog based logic language for writing authorization policies. This really jumped out as powerful and incredibly versatile approach to defining the rules which restrict the authority of a capability.</p>
<p>In terms of features we need though, biscuit tokens cannot be distributed freely, rather the holder of a token gains authority to use it.</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="links-2">Links<a href="#links-2" class="hash-link" aria-label="Direct link to Links" title="Direct link to Links">​</a></h4>
<ul>
<li><a href="https://github.com/biscuit-auth/biscuit/blob/main/SPECIFICATIONS.md" target="_blank" rel="noopener noreferrer">homepage</a></li>
<li><a href="https://doc.biscuitsec.org/getting-started" target="_blank" rel="noopener noreferrer">docs</a></li>
</ul>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="our-approach">Our approach<a href="#our-approach" class="hash-link" aria-label="Direct link to Our approach" title="Direct link to Our approach">​</a></h2>
<p>Our early designs shared many common ideas and provided almost the same features as UCAN tokens. After speaking with some community members it seems there are exciting developments on the next iteration of the specification which take inspiration from some of the descriptive policy features of biscuit as well as other changes which fit our system well. We&#x27;ve therefore based our designs on the (new) UCAN specification where possible. It made sense that we continue to rely on our existing internal data types for identity, signing, resource addressing and encoding formats though, making p2panda tokens not inter-operable with existing UCAN implementations.</p>
<p>Our designs are published in this git repository: <a href="https://github.com/p2panda/capabilities/blob/main/DESIGN.md" target="_blank" rel="noopener noreferrer">https://github.com/p2panda/capabilities/blob/main/DESIGN.md</a></p>
<p>After some final rounds of feedback we&#x27;ll be starting on the Rust implementation.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="thanks">Thanks<a href="#thanks" class="hash-link" aria-label="Direct link to Thanks" title="Direct link to Thanks">​</a></h2>
<p>This research wouldn&#x27;t have been possible without the support we received from the NLNet foundation! Also many thanks to our friends at SSB, Willow, Digital Democracy and Cable for their conversations, feedback and general sharing of excellent related work along the way.</p>
<p>Thanks for reading, see you next time!</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--next" href="/blog/2024/01/17/roadmap-24"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Plans 2024</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#title-capabilities-in-a-p2p-world" class="table-of-contents__link toc-highlight">title: Capabilities in a p2p world</a></li><li><a href="#introduction" class="table-of-contents__link toc-highlight">Introduction</a></li><li><a href="#ownership-in-a-peer-to-peer-world" class="table-of-contents__link toc-highlight">Ownership in a peer-to-peer world</a></li><li><a href="#access-token-basics" class="table-of-contents__link toc-highlight">Access token basics</a></li><li><a href="#what-do-we-need" class="table-of-contents__link toc-highlight">What do we need?</a><ul><li><a href="#supported-ownership-models" class="table-of-contents__link toc-highlight">Supported ownership models</a></li></ul></li><li><a href="#the-research" class="table-of-contents__link toc-highlight">The research</a><ul><li><a href="#captp--ocapn-agoric-spritely-capnproto" class="table-of-contents__link toc-highlight">CapTP / OCapN (Agoric, Spritely, Cap&#39;N&#39;Proto)</a></li><li><a href="#ucan" class="table-of-contents__link toc-highlight">UCAN</a></li><li><a href="#biscuit" class="table-of-contents__link toc-highlight">Biscuit</a></li></ul></li><li><a href="#our-approach" class="table-of-contents__link toc-highlight">Our approach</a></li><li><a href="#thanks" class="table-of-contents__link toc-highlight">Thanks</a></li></ul></div></div></div></div></div><footer class="footer_J6tW"><img class="footer-img__0Xc" src="/images/deepsea-panda.svg" width="100"><div><img class="supporters-img_P2oV" src="/images/nlnet-logo.svg" width="140"><img class="supporters-img_P2oV" src="/images/ngi-logo.png" width="200"><img class="supporters-img_P2oV" src="/images/eu-flag-logo.png" width="78"><p class="footer-text_MXRq">This project has received funding from the European Union’s Horizon 2020 research and innovation programme within the framework of the NGI-POINTER Project funded under grant agreement No 871528, NGI-ASSURE No 957073 and NGI0-ENTRUST No 101069594</p></div><p class="footer-text_MXRq">CC BY-SA 4.0<!-- --> - <a href="/contact">Contact</a> -<!-- --> <a href="https://autonomous.zone/@p2panda" target="_blank" rel="noreferrer">Fediverse</a></p></footer></div>
</body>
</html>