<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-specification/data-types/documents">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">Documents | p2panda</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://p2panda.org/specification/data-types/documents"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Documents | p2panda"><meta data-rh="true" name="description" content="- A Document is a high-level mutable, multi-writer data type constructed from a linked graph of operations."><meta data-rh="true" property="og:description" content="- A Document is a high-level mutable, multi-writer data type constructed from a linked graph of operations."><link data-rh="true" rel="icon" href="/images/deepsea-panda.svg"><link data-rh="true" rel="canonical" href="https://p2panda.org/specification/data-types/documents"><link data-rh="true" rel="alternate" href="https://p2panda.org/specification/data-types/documents" hreflang="en"><link data-rh="true" rel="alternate" href="https://p2panda.org/specification/data-types/documents" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.35ef76d6.css">
<link rel="preload" href="/assets/js/runtime~main.02d4fcd3.js" as="script">
<link rel="preload" href="/assets/js/main.82eb9b0b.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div role="region" aria-label="theme.common.skipToMainContent"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><div class="navbar__brand"><div class="navbar__logo"><img src="/images/p2panda-book.png" class="themedImage_ToTc themedImage--light_HNdA"><img src="/images/p2panda-book.png" class="themedImage_ToTc themedImage--dark_i4oU"></div></div></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/images/p2panda-book.png" alt="p2panda Handbook" class="themedImage_ToTc themedImage--light_HNdA"><img src="/images/p2panda-book.png" alt="p2panda Handbook" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><a class="navbar__item navbar__link" href="/about/">About</a><a class="navbar__item navbar__link" href="/learn/">Learn</a><a class="navbar__item navbar__link" href="/tutorials/">Tutorials</a><a class="navbar__item navbar__link" href="/libraries/">Libraries</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/specification/">Specification</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/faq">FAQ</a><a class="navbar__item navbar__link" href="/links">Links</a><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/"><img src="/images/p2panda-book.png" alt="p2panda Handbook" class="themedImage_ToTc themedImage--light_HNdA"><img src="/images/p2panda-book.png" alt="p2panda Handbook" class="themedImage_ToTc themedImage--dark_i4oU"></a><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/specification/">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/specification/key-concepts">Key Concepts</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/specification/data-types/bamboo">Core data types</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/specification/data-types/bamboo">Bamboo</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/specification/data-types/key-pairs">Key Pairs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/specification/data-types/operations">Operations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/specification/data-types/schemas">Schemas</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/specification/data-types/documents">Documents</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/specification/data-types/document-views">Document views</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/specification/authorisation">Authorisation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/specification/encryption">Encryption</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/specification/APIs/overview">APIs</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/specification/networking/clients-nodes">Networking</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/specification/encoding-data">Canonic Encoding</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/specification/glossary">Glossary</a></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><img src="/images/deepsea-panda.svg" width="30" class="icon-home_wWeS"></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Core data types</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Documents</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Documents</h1></header><ul><li>A Document is a high-level mutable, multi-writer data type constructed from a linked graph of <a href="/specification/data-types/operations">operations</a>.</li><li>Through a deterministic process the graph can be reduced to a single key-value map.</li><li>Any two documents (replicas) which contain the same collection of operations will resolve to the same value.</li><li>A document is identified by the operation id of its root CREATE operation (aka <em>document_id</em>).</li><li>A document assumes the schema of its root CREATE operation</li><li>A document is made up of operations published by one or many authors<ul><li>Branches in a document&#x27;s graph occur when two authors publish operations concurrently</li></ul></li><li>Every operation has a <code>previous</code> field containing a <code>document_view_id</code> which refers to document state <em>at the moment the operation was encoded</em><ul><li>These <code>previous</code> references make up the edges in a graph, the operations being the nodes.</li><li>The graph describes the causal relationship between all operations in a document.</li></ul></li></ul><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><span class="panda-icon">üêª‚Äç‚ùÑÔ∏è</span></span>Fun fact</div><div class="admonitionContent_S0QG"><p>Some things that may be a document in p2panda: a blog post, a wiki page, a chat message, a user account, a configuration setting, a game board.</p></div></div><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><span class="panda-icon">üå©Ô∏è</span></span>Requirement DO1</div><div class="admonitionContent_S0QG"><p>A document MUST contain exactly one CREATE operation.</p></div></div><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><span class="panda-icon">üå©Ô∏è</span></span>Requirement DO2</div><div class="admonitionContent_S0QG"><p>A document&#x27;s operation graph MUST NOT contain any cycles.</p></div></div><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><span class="panda-icon">üå©Ô∏è</span></span>Requirement DO3</div><div class="admonitionContent_S0QG"><p>A document MUST NOT contain an operation who&#x27;s <code>previous</code> refers to an operation not present in the document&#x27;s graph.</p></div></div><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><span class="panda-icon">üå©Ô∏è</span></span>Requirement DO4</div><div class="admonitionContent_S0QG"><p>If a document contains any number of DELETE operations it SHOULD be considered deleted. After this point, new operations
SHOULD NOT be appended to any point on the document.</p></div></div><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><span class="panda-icon">üå©Ô∏è</span></span>Requirement DO5</div><div class="admonitionContent_S0QG"><p>A documents&#x27; operations MUST be encoded on entries which are published to a single log for each contributing author/public key.</p></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="viewing-a-document">Viewing a document<a class="hash-link" href="#viewing-a-document" title="Direct link to heading">‚Äã</a></h2><ul><li>When viewing documents, it&#x27;s state must be reduced to a single key-value map, this process involves two steps:</li></ul><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><span class="panda-icon">üêº</span></span>Definition: Materialisation</div><div class="admonitionContent_S0QG"><p>Although here we describe the resolving an operation graph as a property of the data type <em>document</em> it can also be seen as the process of <em>materialisation</em>. This is a term borrowed from database terminology, where views on data can be materialised into virtual tables. This is a useful concept in p2panda and one that is used often.</p></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1-reconciliation">1. Reconciliation<a class="hash-link" href="#1-reconciliation" title="Direct link to heading">‚Äã</a></h3><ul><li>The first step we take is to sort and linearise the document&#x27;s graph of operations deterministically.</li><li>We do this by applying a topological depth-first sorting algorithm which meets the following requirements:</li></ul><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><span class="panda-icon">üå©Ô∏è</span></span>Requirement DO6</div><div class="admonitionContent_S0QG"><p>Sorting MUST start from the document&#x27;s CREATE operation.</p></div></div><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><span class="panda-icon">üå©Ô∏è</span></span>Requirement DO7</div><div class="admonitionContent_S0QG"><p>An operation which refers to the current operation in its <code>previous</code> field MUST be sorted next.</p></div></div><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><span class="panda-icon">üå©Ô∏è</span></span>Requirement DO8</div><div class="admonitionContent_S0QG"><p>If multiple operations refer to the current, the one with the lowest <code>document_id</code> MUST be sorted next.</p></div></div><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><span class="panda-icon">üå©Ô∏è</span></span>Requirement DO9</div><div class="admonitionContent_S0QG"><p>When visiting a branch, all operations it contains MUST be visited and sorted before continuing to the rest of the graph.</p></div></div><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><span class="panda-icon">üå©Ô∏è</span></span>Requirement D10</div><div class="admonitionContent_S0QG"><p>All operations in the graph MUST be sorted exactly once.</p></div></div><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><span class="panda-icon">üå©Ô∏è</span></span>Requirement D11</div><div class="admonitionContent_S0QG"><p>If any DELETE operation is visited, materialisation of the document MUST stop immediately. The resulting document view id MUST include
only the id of the DELETE operation and no document view should be produced.</p></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2-reduction">2. Reduction<a class="hash-link" href="#2-reduction" title="Direct link to heading">‚Äã</a></h3><ul><li><p>The second and final step is to reduce the linearlised list of operations into a single key-value map by applying the following rules:</p><ol><li>Deserialise all fields of the document&#x27;s CREATE operation to produce a <em>document view</em></li><li>If the next operation in the document is an UPDATE operation<ul><li>for every field in the operation<ul><li>overwrite this field&#x27;s contents on the view with the contents from the operation</li></ul></li></ul></li><li>If the next operation in the document is a DELETE operation<ul><li>remove the content on all fields of the view</li><li>mark the view delete</li><li>stop reduction here</li></ul></li><li>Stop reduction if there is no next known operation in the document</li><li>Continue with step 2. otherwise</li></ol></li></ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/specification/data-types/schemas"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Schemas</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/specification/data-types/document-views"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Document views</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#viewing-a-document" class="table-of-contents__link toc-highlight">Viewing a document</a><ul><li><a href="#1-reconciliation" class="table-of-contents__link toc-highlight">1. Reconciliation</a></li><li><a href="#2-reduction" class="table-of-contents__link toc-highlight">2. Reduction</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer_J6tW"><img class="footer-img__0Xc" src="/images/deepsea-panda.svg" width="100"><div><img class="supporters-img_P2oV" src="/images/ngi-logo.png" width="200"><img class="supporters-img_P2oV" src="/images/eu-flag-logo.png" width="78"><p class="footer-text_MXRq">This project has received funding from the European Union‚Äôs Horizon 2020 research and innovation programme within the framework of the NGI-POINTER Project funded under grant agreement No 871528</p></div><p class="footer-text_MXRq">CC BY-SA 4.0<!-- --> - <a href="mailto:contributors@p2panda.org">Contact</a></p></footer></div>
<script src="/assets/js/runtime~main.02d4fcd3.js"></script>
<script src="/assets/js/main.82eb9b0b.js"></script>
</body>
</html>